!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.splitio=e():t.splitio=e()}(window,(function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=19)}([function(t,e,n){"use strict";n.d(e,"o",(function(){return o})),n.d(e,"a",(function(){return a})),n.d(e,"e",(function(){return s})),n.d(e,"c",(function(){return c})),n.d(e,"b",(function(){return u})),n.d(e,"j",(function(){return l})),n.d(e,"l",(function(){return f})),n.d(e,"m",(function(){return h})),n.d(e,"t",(function(){return g})),n.d(e,"i",(function(){return d})),n.d(e,"k",(function(){return m})),n.d(e,"s",(function(){return v})),n.d(e,"r",(function(){return y})),n.d(e,"q",(function(){return S})),n.d(e,"p",(function(){return T})),n.d(e,"d",(function(){return b})),n.d(e,"g",(function(){return E})),n.d(e,"f",(function(){return _})),n.d(e,"n",(function(){return O})),n.d(e,"h",(function(){return N}));var r=n(9),i=n.n(r);function o(t,e){return!(!l(t)||!l(e))&&t.slice(0,e.length)===e}function a(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return!(!l(t)||!l(e))&&(n&&(t=t.toLowerCase(),e=e.toLowerCase()),t.slice(t.length-e.length)===e)}function s(t,e,n){var r=n;try{var i=e.split("."),o=t;i.forEach((function(t){return o=o[t]})),void 0!==o&&(r=o)}catch(t){}return r}function c(t,e){if(Array.isArray(t)&&"function"==typeof e)for(var n=0;n<t.length;n++)if(!0===e(t[n],n,t))return n;return-1}function u(t,e){var n;if(d(t))for(var r=Object.keys(t),i=0;i<r.length&&!n;i++){var o=r[i];e(t[o],o,t)&&(n=t[o])}else if(Array.isArray(t))for(var a=0;a<t.length&&!n;a++){e(t[a],a,t)&&(n=t[a])}return n}function l(t){return"string"==typeof t||t instanceof String}function f(t){return t instanceof Number&&(t=t.valueOf()),"number"==typeof t&&(Number.isFinite?Number.isFinite(t):isFinite(t))}function h(t){return t instanceof Number&&(t=t.valueOf()),t!=t}var p=-1;function g(){return p++}function d(t){return t&&"object"===i()(t)&&t.constructor===Object}function m(t,e){var n=t;d(e)&&Object.keys(e).forEach((function(t){var r=e[t];d(r)&&(r=n[t]&&d(n[t])?m({},n[t],r):m({},r)),void 0!==r&&(n[t]=r)}));for(var r=arguments.length,i=new Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];if(i&&i.length){var a=i.splice(0,1)[0];n=m.apply(void 0,[n,a].concat(i))}return n}function v(t){var e={};return t.filter((function(t){return!Object.prototype.hasOwnProperty.call(e,t)&&(e[t]=!0)}))}function y(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:JSON.stringify,n={};return t.filter((function(t){var r=e(t);return!Object.prototype.hasOwnProperty.call(n,r)&&(n[r]=!0)}))}function S(t){if(null==t)return"";if("string"==typeof t)return t;if(Array.isArray(t))return t.map((function(t){return l(t)?t:""}))+"";var e=t+"";return"0"===e&&1/t===Number.NEGATIVE_INFINITY?"-0":e}function T(t){if("number"==typeof t)return t;if(d(t)&&"function"==typeof t.valueOf){var e=t.valueOf();t=d(e)?e+"":e}return"string"!=typeof t?0===t?t:+t:+(t=t.replace(/^\s+|\s+$/g,""))}function b(t,e){return Object.keys(t).forEach((function(n){return e(t[n],n,t)})),t}function E(t,e){var n={};if(Array.isArray(t)&&l(e))for(var r=0;r<t.length;r++){var i=t[r][e];l(i)&&(n[i]||(n[i]=[]),n[i].push(t[r]))}return n}function _(t){return t.name?t.name:(t.toString().match(/function (.+?)\(/)||["",""])[1]}function O(t){for(var e=Object.keys(t),n={},r=0;r<e.length;r++)n[e[r]]=t[e[r]];return n}function N(t){return!0===t||!1===t}},function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return h}));var r=n(5),i=n(12),o=n(0),a=function(t){return!!Object(o.b)(r.a,(function(e){return t===e}))},s={showLevel:!0,displayAllErrors:!1},c=!1;void 0!==t&&void 0!==t.version&&t.version&&(c=!0);var u=String(c?t.env.SPLITIO_DEBUG:Object(i.a)()?localStorage.getItem("splitio_debug"):""),l=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new r.b(t,Object(o.k)(e,s))},f=l("splitio-utils:logger"),h={enable:function(){Object(r.c)(r.a.DEBUG)},setLogLevel:function(t){a(t)?Object(r.c)(t):f.error("Invalid Log Level - No changes to the logs will be applied.")},disable:function(){Object(r.c)(r.a.NONE)},LogLevel:r.a};/^(enabled?|on)/i.test(u)?h.enable(r.a.DEBUG):a(u)?h.setLogLevel(u):h.disable(),e.b=l}).call(this,n(20))},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e,n){"use strict";
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;function a(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}t.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},n=0;n<10;n++)e["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(t){r[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var n,s,c=a(t),u=1;u<arguments.length;u++){for(var l in n=Object(arguments[u]))i.call(n,l)&&(c[l]=n[l]);if(r){s=r(n);for(var f=0;f<s.length;f++)o.call(n,s[f])&&(c[s[f]]=n[s[f]])}}return c}},function(t,e){function n(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}t.exports=function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}},function(t,e,n){"use strict";n.d(e,"a",(function(){return u})),n.d(e,"c",(function(){return f})),n.d(e,"b",(function(){return p}));var r=n(2),i=n.n(r),o=n(4),a=n.n(o),s=n(3),c=n.n(s),u={DEBUG:"DEBUG",INFO:"INFO",WARN:"WARN",ERROR:"ERROR",NONE:"NONE"},l=u.DEBUG,f=function(t){l=t},h={showLevel:!0,displayAllErrors:!1},p=function(){function t(e,n){i()(this,t),this.category=e,this.options=c()({},h,n)}return a()(t,[{key:"debug",value:function(t){this._shouldLog(u.DEBUG)&&this._log(u.DEBUG,t)}},{key:"info",value:function(t){this._shouldLog(u.INFO)&&this._log(u.INFO,t)}},{key:"warn",value:function(t){this._shouldLog(u.WARN)&&this._log(u.WARN,t)}},{key:"error",value:function(t){(this.options.displayAllErrors||this._shouldLog(u.ERROR))&&this._log(u.ERROR,t)}},{key:"_log",value:function(t,e){var n=this._generateLogMessage(t,e);console.log(n)}},{key:"_generateLogMessage",value:function(t,e){var n="";return this.options.showLevel&&(n+="["+t+"]"+(t===u.INFO||t===u.WARN?" ":"")+" "),this.category&&(n+=this.category+" => "),n+e}},{key:"_shouldLog",value:function(t){var e=l,n=Object.keys(u).map((function(t){return u[t]}));return n.indexOf(t)>=n.indexOf(e)}}]),t}()},function(t,e){function n(e){return t.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},n(e)}t.exports=n},function(t,e,n){var r=n(14);t.exports=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&r(t,e)}},function(t,e){t.exports=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}},function(t,e){function n(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=n=function(t){return typeof t}:t.exports=n=function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},n(e)}t.exports=n},function(t,e,n){var r=n(9),i=n(25);t.exports=function(t,e){return!e||"object"!==r(e)&&"function"!=typeof e?i(t):e}},function(t,e,n){"use strict";var r,i="object"==typeof Reflect?Reflect:null,o=i&&"function"==typeof i.apply?i.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)};r=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var a=Number.isNaN||function(t){return t!=t};function s(){s.init.call(this)}t.exports=s,s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var c=10;function u(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function l(t){return void 0===t._maxListeners?s.defaultMaxListeners:t._maxListeners}function f(t,e,n,r){var i,o,a,s;if(u(n),void 0===(o=t._events)?(o=t._events=Object.create(null),t._eventsCount=0):(void 0!==o.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),o=t._events),a=o[e]),void 0===a)a=o[e]=n,++t._eventsCount;else if("function"==typeof a?a=o[e]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),(i=l(t))>0&&a.length>i&&!a.warned){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=a.length,s=c,console&&console.warn&&console.warn(s)}return t}function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=h.bind(r);return i.listener=n,r.wrapFn=i,i}function g(t,e,n){var r=t._events;if(void 0===r)return[];var i=r[e];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(i):m(i,i.length)}function d(t){var e=this._events;if(void 0!==e){var n=e[t];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function m(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(t){if("number"!=typeof t||t<0||a(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");c=t}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||a(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},s.prototype.getMaxListeners=function(){return l(this)},s.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var r="error"===t,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var a;if(e.length>0&&(a=e[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var c=i[t];if(void 0===c)return!1;if("function"==typeof c)o(c,this,e);else{var u=c.length,l=m(c,u);for(n=0;n<u;++n)o(l[n],this,e)}return!0},s.prototype.addListener=function(t,e){return f(this,t,e,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(t,e){return f(this,t,e,!0)},s.prototype.once=function(t,e){return u(e),this.on(t,p(this,t,e)),this},s.prototype.prependOnceListener=function(t,e){return u(e),this.prependListener(t,p(this,t,e)),this},s.prototype.removeListener=function(t,e){var n,r,i,o,a;if(u(e),void 0===(r=this._events))return this;if(void 0===(n=r[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===e||n[o].listener===e){a=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(n,i),1===n.length&&(r[t]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",t,a||e)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(t){var e,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[t]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(void 0!==e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},s.prototype.listeners=function(t){return g(this,t,!0)},s.prototype.rawListeners=function(t){return g(this,t,!1)},s.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):d.call(t,e)},s.prototype.listenerCount=d,s.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(t,e,n){"use strict";function r(){var t="__SPLITSOFTWARE__";try{return localStorage.setItem(t,t),localStorage.removeItem(t),!0}catch(t){return!1}}n.d(e,"a",(function(){return r}))},function(t,e,n){t.exports=n(26)},function(t,e){function n(e,r){return t.exports=n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},n(e,r)}t.exports=n},function(t,e){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}},function(t,e,n){var r=n(21),i=n(22),o=n(23),a=n(24);t.exports=function(t){return r(t)||i(t)||o(t)||a()}},function(t){t.exports=JSON.parse('{"a":"10.14.1"}')},function(t,e,n){var r=n(6),i=n(14),o=n(27),a=n(28);function s(e){var n="function"==typeof Map?new Map:void 0;return t.exports=s=function(t){if(null===t||!o(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(t))return n.get(t);n.set(t,e)}function e(){return a(t,arguments,r(this).constructor)}return e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),i(e,t)},s(e)}t.exports=s},function(t,e,n){t.exports=n(30)},function(t,e){var n,r,i=t.exports={};function o(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function s(t){if(n===setTimeout)return setTimeout(t,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(t){n=o}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(t){r=a}}();var c,u=[],l=!1,f=-1;function h(){l&&c&&(l=!1,c.length?u=c.concat(u):f=-1,u.length&&p())}function p(){if(!l){var t=s(h);l=!0;for(var e=u.length;e;){for(c=u,u=[];++f<e;)c&&c[f].run();f=-1,e=u.length}c=null,l=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function g(t,e){this.fun=t,this.array=e}function d(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];u.push(new g(t,e)),1!==u.length||l||s(p)},g.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=d,i.addListener=d,i.once=d,i.off=d,i.removeListener=d,i.removeAllListeners=d,i.emit=d,i.prependListener=d,i.prependOnceListener=d,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e,n){var r=n(15);t.exports=function(t){if(Array.isArray(t))return r(t)}},function(t,e){t.exports=function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}},function(t,e,n){var r=n(15);t.exports=function(t,e){if(t){if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(t,e){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}},function(t,e,n){var r,i;
/**
 * @license utfx (c) 2014 Daniel Wirtz <dcode@dcode.io>
 * Released under the Apache License, Version 2.0
 * see: https://github.com/dcodeIO/utfx for details
 */void 0===(i="function"==typeof(r=function(){"use strict";Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)});var t={MAX_CODEPOINT:1114111,encodeUTF8:function(t,e){var n=null;for("number"==typeof t&&(n=t,t=function(){return null});null!==n||null!==(n=t());)n<128?e(127&n):n<2048?(e(n>>6&31|192),e(63&n|128)):n<65536?(e(n>>12&15|224),e(n>>6&63|128),e(63&n|128)):(e(n>>18&7|240),e(n>>12&63|128),e(n>>6&63|128),e(63&n|128)),n=null},decodeUTF8:function(t,e){for(var n,r,i,o,a=function(t){t=t.slice(0,t.indexOf(null));var e=Error(t.toString());throw e.name="TruncatedError",e.bytes=t,e};null!==(n=t());)if(0==(128&n))e(n);else if(192==(224&n))null===(r=t())&&a([n,r]),e((31&n)<<6|63&r);else if(224==(240&n))(null===(r=t())||null===(i=t()))&&a([n,r,i]),e((15&n)<<12|(63&r)<<6|63&i);else{if(240!=(248&n))throw RangeError("Illegal starting byte: "+n);(null===(r=t())||null===(i=t())||null===(o=t()))&&a([n,r,i,o]),e((7&n)<<18|(63&r)<<12|(63&i)<<6|63&o)}},UTF16toUTF8:function(t,e){for(var n,r=null;null!==(n=null!==r?r:t());)n>=55296&&n<=57343&&null!==(r=t())&&r>=56320&&r<=57343?(e(1024*(n-55296)+r-56320+65536),r=null):e(n);null!==r&&e(r)},UTF8toUTF16:function(t,e){var n=null;for("number"==typeof t&&(n=t,t=function(){return null});null!==n||null!==(n=t());)n<=65535?e(n):(e(55296+((n-=65536)>>10)),e(n%1024+56320)),n=null},encodeUTF16toUTF8:function(e,n){t.UTF16toUTF8(e,(function(e){t.encodeUTF8(e,n)}))},decodeUTF8toUTF16:function(e,n){t.decodeUTF8(e,(function(e){t.UTF8toUTF16(e,n)}))},calculateCodePoint:function(t){return t<128?1:t<2048?2:t<65536?3:4},calculateUTF8:function(t){for(var e,n=0;null!==(e=t());)n+=e<128?1:e<2048?2:e<65536?3:4;return n},calculateUTF16asUTF8:function(e){var n=0,r=0;return t.UTF16toUTF8(e,(function(t){++n,r+=t<128?1:t<2048?2:t<65536?3:4})),[n,r]}},e=String.fromCharCode;return t.arraySource=function(t){if(!Array.isArray(t))throw TypeError("Illegal argument: "+typeof t);var e=0;return function(){return e>=t.length?null:t[e++]}},t.arrayDestination=function(t){if(!Array.isArray(t))throw TypeError("Illegal argument: "+typeof t);return Array.prototype.push.bind(t)},t.stringSource=function(t){if("string"!=typeof t)throw TypeError("Illegal argument: "+typeof t);var e=0;return function(){return e>=t.length?null:t.charCodeAt(e++)}},t.stringDestination=function(){var t=[],n=[];return function(){if(0===arguments.length)return n.join("")+e.apply(String,t);t.length+arguments.length>1024&&(n.push(e.apply(String,t)),t.length=0),Array.prototype.push.apply(t,arguments)}},t.assertCharCode=function(t){if("number"!=typeof t||t!=t)throw TypeError("Illegal char code: "+typeof t);if(t<0||t>65535)throw RangeError("Illegal char code: "+t);return t},t.assertCodePoint=function(e){if("number"!=typeof e||e!=e)throw TypeError("Illegal code point: "+typeof e);if(e<0||e>t.MAX_CODEPOINT)throw RangeError("Illegal code point: "+e);return e},t.fromCodePoint=function(e){var n,r=0,i=arguments,o=i.length;return t.UTF8toUTF16((function(){return r<o?t.assertCodePoint(i[r++]):null}),n=t.stringDestination()),n()},t.codePointAt=function(e,n){if("string"!=typeof e&&!(e&&e instanceof String)||"number"!=typeof n)throw TypeError("Illegal arguments: "+typeof e+", "+typeof n);var r,i;if(!(n<0||n>=(r=e.length)))return t.UTF16toUTF8((function(){return void 0===i&&n<r?e.charCodeAt(n++):null}),(function(t){i=t})),i},t.polyfill=function(e){return String.fromCodePoint&&!e||(String.fromCodePoint=t.fromCodePoint),String.prototype.codePointAt&&!e||(String.prototype.codePointAt=function(e){return t.codePointAt(this,e)}),t},t})?r.call(e,n,e,t):r)||(t.exports=i)},function(t,e){t.exports=function(t){return-1!==Function.toString.call(t).indexOf("[native code]")}},function(t,e,n){var r=n(14),i=n(29);function o(e,n,a){return i()?t.exports=o=Reflect.construct:t.exports=o=function(t,e,n){var i=[null];i.push.apply(i,e);var o=new(Function.bind.apply(t,i));return n&&r(o,n.prototype),o},o.apply(null,arguments)}t.exports=o},function(t,e){t.exports=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}},function(t,e,n){"use strict";n.r(e);var r=n(3),i=n.n(r),o=function(t){return null!=t&&"function"==typeof t.then},a=n(0),s=n(1),c=Object(s.b)("",{displayAllErrors:!0}),u={};function l(t){u[t]&&u[t]--,0===u[t]&&delete u[t]}var f=Object(s.b)("");var h=Object(s.b)(""),p=/^[a-zA-Z0-9][-_.:a-zA-Z0-9]{0,79}$/;function g(t,e){if(null==t)h.error("".concat(e,": you passed a null or undefined event_type, event_type must be a non-empty string."));else if(Object(a.j)(t))if(0===t.length)h.error("".concat(e,": you passed an empty event_type, event_type must be a non-empty string."));else{if(p.test(t))return t;h.error("".concat(e,': you passed "').concat(t,'", event_type must adhere to the regular expression /^[a-zA-Z0-9][-_.:a-zA-Z0-9]{0,79}$/g. This means an event_type must be alphanumeric, cannot be more than 80 characters long, and can only include a dash, underscore, period, or colon as separators of alphanumeric characters.'))}else h.error("".concat(e,": you passed an invalid event_type, event_type must be a non-empty string."));return!1}var d=Object(s.b)("");function m(t,e){return Object(a.l)(t)||null==t?t:(d.error("".concat(e,": value must be a finite number.")),!1)}var v=Object(s.b)(""),y=0,S=2,T=4,b=8;function E(t,e){if(null==t)return{properties:null,size:1024};if(!Object(a.i)(t))return v.error("".concat(e,": properties must be a plain object.")),{properties:!1,size:1024};var n=Object.keys(t),r=Object(a.n)(t),i={properties:r,size:1024};n.length>300&&v.warn("".concat(e,": Event has more than 300 properties. Some of them will be trimmed when processed."));for(var o=0;o<n.length;o++){i.size+=n[o].length*S;var s=r[n[o]],c=Object(a.j)(s),u=Object(a.l)(s),l=Object(a.h)(s),f=null===s;if(c||u||l||f||(r[n[o]]=null,s=null,f=!0,v.warn("".concat(e,": Property ").concat(n[o]," is of invalid type. Setting value to null."))),f?i.size+=y:u?i.size+=b:l?i.size+=T:c&&(i.size+=s.length*S),i.size>32768){v.error("".concat(e,": The maximum size allowed for the properties is 32768 bytes, which was exceeded. Event not queued.")),i.properties=!1;break}}return i}var _=Object(s.b)("");function O(t,e,n){if(null==t)return _.error("".concat(e,": you passed a null or undefined ").concat(n,", ").concat(n," must be a non-empty string.")),!1;if(Object(a.l)(t))return _.warn("".concat(e,": ").concat(n,' "').concat(t,'" is not of type string, converting.')),Object(a.q)(t);if(Object(a.j)(t)){if((t=t.trim()).length>0&&t.length<=250)return t;0===t.length?_.error("".concat(e,": you passed an empty string, ").concat(n," must be a non-empty string.")):t.length>250&&_.error("".concat(e,": ").concat(n," too long, ").concat(n," must be 250 characters or less."))}else _.error("".concat(e,": you passed an invalid ").concat(n," type, ").concat(n," must be a non-empty string."));return!1}function N(t,e){if(Object(a.i)(t)){var n=O(t.matchingKey,e,"matchingKey"),r=O(t.bucketingKey,e,"bucketingKey");return n&&r?{matchingKey:n,bucketingKey:r}:(_.error("".concat(e,": Key must be an object with bucketingKey and matchingKey with valid string properties.")),!1)}return O(t,e,"key")}var k=Object(s.b)(""),A=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/;function R(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"split name";if(null==t)k.error("".concat(e,": you passed a null or undefined ").concat(n,", ").concat(n," must be a non-empty string."));else if(Object(a.j)(t)){if(A.test(t)&&(k.warn("".concat(e,": ").concat(n,' "').concat(t,'" has extra whitespace, trimming.')),t=t.trim()),t.length>0)return t;k.error("".concat(e,": you passed an empty ").concat(n,", ").concat(n," must be a non-empty string."))}else k.error("".concat(e,": you passed an invalid ").concat(n,", ").concat(n," must be a non-empty string."));return!1}function w(t,e,n,r){return!t.get(t.constants.READY,!0)||"definition not found"!==n&&null!=n||(k.warn("".concat(r,': you passed "').concat(e,'" that does not exist in this environment, please double check what Splits exist in the web console.')),!1)}var I=Object(s.b)("");function C(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"split_names",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"split name";if(Array.isArray(t)&&t.length>0){var i=[];if(t.forEach((function(t){var n=R(t,e,r);n&&i.push(n)})),i.length)return Object(a.s)(i)}return I.error("".concat(e,": ").concat(n," must be a non-empty array.")),!1}var D="standalone",L="producer",j="consumer",M="control",P={treatment:M,config:null},F=[{type:"byName",maxLength:400,queryParam:"names="},{type:"byPrefix",maxLength:50,queryParam:"prefixes="}],x=Object(s.b)(""),K=/[A-Z]/;function G(t,e){if(null==t)x.error("".concat(e,": you passed a null or undefined traffic_type_name, traffic_type_name must be a non-empty string."));else if(Object(a.j)(t)){if(0!==t.length)return K.test(t)&&(x.warn("".concat(e,": traffic_type_name should be all lowercase - converting string to lowercase.")),t=t.toLowerCase()),t;x.error("".concat(e,": you passed an empty traffic_type_name, traffic_type_name must be a non-empty string."))}else x.error("".concat(e,": you passed an invalid traffic_type_name, traffic_type_name must be a non-empty string."));return!1}function U(t,e){x.warn("".concat(t,": Traffic Type ").concat(e," does not have any corresponding Splits in this environment, make sure you're tracking your events to a valid traffic type defined in the Split console."))}function H(t,e,n){var r=e.get(e.constants.READY,!0),i=e.get(e.constants.SETTINGS),a=e.get(e.constants.STORAGE).splits;if(!r||"localhost"===i.mode)return!0;var s=a.trafficTypeExists(t);return o(s)?s.then((function(e){return e||U(n,t),e})):s||U(n,t),s}var W=Object(s.b)("",{displayAllErrors:!0});function B(t){return!t.get(t.constants.DESTROYED,!0)||(W.error("Client has already been destroyed - no calls possible."),!1)}function Y(t,e){return!(!t.get(t.constants.READY,!0)&&!t.get(t.constants.READY_FROM_CACHE,!0))||(W.warn("".concat(e,": the SDK is not ready, results may be incorrect. Make sure to wait for SDK readiness before using this method.")),!1)}var q=function(t){var e=t.conditions,n=Object(a.b)(e,(function(t){return"ROLLOUT"===t.conditionType}));return n||(n=e[0]),n?n.partitions.map((function(t){return t.treatment})):[]},z=function(t){var e;try{e=JSON.parse(t)}catch(t){return null}return null==e?null:{name:e.name,trafficType:e.trafficTypeName||null,killed:e.killed,changeNumber:e.changeNumber||0,treatments:q(e),configs:e.configurations||{}}},V=function(t){var e=[];return t.forEach((function(t){var n=z(t);null!=n&&e.push(n)})),e};var Q=function(t,e){var n=e.get(e.constants.STATUS_MANAGER);return i()(Object.create(n),{split:function(n){var r=R(n,"split");if(!B(e)||!Y(e,"split")||!r)return null;var i=t.getSplit(r);return o(i)?i.then((function(t){return w(e,r,t,"split"),z(t)})):(w(e,r,i,"split"),z(i))},splits:function(){if(!B(e)||!Y(e,"splits"))return[];var n=t.getAll();return o(n)?n.then(V):V(n)},names:function(){return B(e)&&Y(e,"names")?t.getKeys():[]}})},J=n(2),$=n.n(J),Z=n(4),X=n.n(Z);var tt=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=0;e<t.length;e++)for(var n=t[e].matcherGroup.matchers,r=0;r<n.length;r++)if("IN_SEGMENT"===n[r].matcherType)return!0;return!1};function et(t,e,n){var r=this,i=this.getSplit(t);return(o(i)?i:Promise.resolve(i)).then((function(i){if(i){var o=JSON.parse(i);if(!o.changeNumber||o.changeNumber<n){o.killed=!0,o.defaultTreatment=e,o.changeNumber=n;var a=JSON.stringify(o);return r.addSplit(t,a)}}return!1}))}var nt=function(){function t(){$()(this,t),this.flush()}return X()(t,[{key:"addSplit",value:function(t,e){var n=this.getSplit(t);if(n){var r=JSON.parse(n);if(r.trafficTypeName){var i=r.trafficTypeName;this.ttCache[i]--,this.ttCache[i]||delete this.ttCache[i]}tt(r.conditions)&&this.splitsWithSegmentsCount--}var o=JSON.parse(e);if(o){this.splitCache[t]=e;var a=o.trafficTypeName;return a&&(this.ttCache[a]||(this.ttCache[a]=0),this.ttCache[a]++),tt(o.conditions)&&this.splitsWithSegmentsCount++,!0}return!1}},{key:"addSplits",value:function(t){var e=this,n=[];return t.forEach((function(t){n.push(e.addSplit(t[0],t[1]))})),n}},{key:"removeSplit",value:function(t){var e=this.getSplit(t);if(e){delete this.splitCache[t];var n=JSON.parse(e),r=n.trafficTypeName;return r&&(this.ttCache[r]--,this.ttCache[r]||delete this.ttCache[r]),tt(n.conditions)&&this.splitsWithSegmentsCount--,1}return 0}},{key:"removeSplits",value:function(t){var e=this;return t.forEach((function(t){return e.removeSplit(t)})),t.length}},{key:"getSplit",value:function(t){return this.splitCache[t]}},{key:"setChangeNumber",value:function(t){return this.changeNumber=t,!0}},{key:"getChangeNumber",value:function(){return this.changeNumber}},{key:"getAll",value:function(){var t=this;return this.getKeys().map((function(e){return t.splitCache[e]}))}},{key:"getKeys",value:function(){return Object.keys(this.splitCache)}},{key:"trafficTypeExists",value:function(t){return Object(a.l)(this.ttCache[t])&&this.ttCache[t]>0}},{key:"usesSegments",value:function(){return-1===this.getChangeNumber()||this.splitsWithSegmentsCount>0}},{key:"flush",value:function(){this.splitCache={},this.ttCache={},this.changeNumber=-1,this.splitsWithSegmentsCount=0}},{key:"fetchMany",value:function(t){var e=this,n={};return t.forEach((function(t){n[t]=e.splitCache[t]||null})),n}},{key:"checkCache",value:function(){return!1}}]),t}();nt.prototype.killLocally=et;var rt=nt,it=Object(s.b)("splitio-storage:localstorage"),ot=function(){function t(e,n,r){$()(this,t),this.keys=e,this.splitFiltersValidation=r,this.__checkExpiration(n),this.__checkFilterQuery()}return X()(t,[{key:"decrementCount",value:function(t){var e=Object(a.p)(localStorage.getItem(t))-1;e>0?localStorage.setItem(t,e):localStorage.removeItem(t)}},{key:"decrementCounts",value:function(t){try{if(t){if(t.trafficTypeName){var e=this.keys.buildTrafficTypeKey(t.trafficTypeName);this.decrementCount(e)}if(tt(t.conditions)){var n=this.keys.buildSplitsWithSegmentCountKey();this.decrementCount(n)}}}catch(t){it.error(t)}}},{key:"incrementCounts",value:function(t){try{if(t){if(t.trafficTypeName){var e=this.keys.buildTrafficTypeKey(t.trafficTypeName);localStorage.setItem(e,Object(a.p)(localStorage.getItem(e))+1)}if(tt(t.conditions)){var n=this.keys.buildSplitsWithSegmentCountKey();localStorage.setItem(n,Object(a.p)(localStorage.getItem(n))+1)}}}catch(t){it.error(t)}}},{key:"addSplit",value:function(t,e){try{var n=this.keys.buildSplitKey(t),r=localStorage.getItem(n),i=r?JSON.parse(r):null;this.decrementCounts(i),localStorage.setItem(n,e);var o=e?JSON.parse(e):null;return this.incrementCounts(o),!0}catch(t){return it.error(t),!1}}},{key:"addSplits",value:function(t){var e=this,n=[];return t.forEach((function(t){n.push(e.addSplit(t[0],t[1]))})),n}},{key:"removeSplit",value:function(t){try{var e=this.getSplit(t);localStorage.removeItem(this.keys.buildSplitKey(t));var n=JSON.parse(e);return this.decrementCounts(n),1}catch(t){return it.error(t),0}}},{key:"removeSplits",value:function(t){for(var e=0,n=t.length,r=0;e<n;e++)r+=this.removeSplit(t[e]);return r}},{key:"getSplit",value:function(t){return localStorage.getItem(this.keys.buildSplitKey(t))}},{key:"setChangeNumber",value:function(t){if(this.cacheReadyButNeedsToFlush&&(this.flush(),this.cacheReadyButNeedsToFlush=!1),this.updateNewFilter){it.info("Split filter query was modified. Updating cache.");var e=this.keys.buildSplitsFilterQueryKey(),n=this.splitFiltersValidation.queryString;try{n?localStorage.setItem(e,n):localStorage.removeItem(e)}catch(t){it.error(t)}this.updateNewFilter=!1}try{return localStorage.setItem(this.keys.buildSplitsTillKey(),t+""),localStorage.setItem(this.keys.buildLastUpdatedKey(),Date.now()+""),this.hasSync=!0,!0}catch(t){return it.error(t),!1}}},{key:"getChangeNumber",value:function(){var t=localStorage.getItem(this.keys.buildSplitsTillKey());return null!==t?(t=parseInt(t,10),Object(a.m)(t)?-1:t):-1}},{key:"getAll",value:function(){for(var t=localStorage.length,e=[],n=0;n<t;){var r=localStorage.key(n),i=r&&localStorage.getItem(r);null!=r&&this.keys.isSplitKey(r)&&i&&e.push(i),n++}return e}},{key:"getKeys",value:function(){for(var t=localStorage.length,e=[],n=0;n<t;){var r=localStorage.key(n);null!=r&&this.keys.isSplitKey(r)&&e.push(this.keys.extractKey(r)),n++}return e}},{key:"trafficTypeExists",value:function(t){var e=Object(a.p)(localStorage.getItem(this.keys.buildTrafficTypeKey(t)));return Object(a.l)(e)&&e>0}},{key:"usesSegments",value:function(){if(!this.hasSync)return!0;var t=localStorage.getItem(this.keys.buildSplitsWithSegmentCountKey()),e=null===t?0:Object(a.p)(t);return!Object(a.l)(e)||e>0}},{key:"flush",value:function(){it.info("Flushing Splits data from localStorage");for(var t=localStorage.length,e=[],n=0;n<t;n++){var r=localStorage.key(n);null!=r&&this.keys.isSplitCacheKey(r)&&e.push(r)}e.forEach((function(t){localStorage.removeItem(t)})),this.hasSync=!1}},{key:"fetchMany",value:function(t){var e=this,n={};return t.forEach((function(t){n[t]=localStorage.getItem(e.keys.buildSplitKey(t))})),n}},{key:"checkCache",value:function(){return this.getChangeNumber()>-1||this.cacheReadyButNeedsToFlush}},{key:"__checkExpiration",value:function(t){var e=localStorage.getItem(this.keys.buildLastUpdatedKey());null!==e&&(e=parseInt(e,10),!Object(a.m)(e)&&e<t&&this.flush())}},{key:"__checkFilterQuery",value:function(){var t=this,e=this.splitFiltersValidation,n=e.queryString,r=e.groupedFilters,i=this.keys.buildSplitsFilterQueryKey();if(localStorage.getItem(i)!==n)try{this.updateNewFilter=!0,this.checkCache()&&(localStorage.setItem(this.keys.buildSplitsTillKey(),"-1"),this.getKeys().forEach((function(e){n&&(r.byName.indexOf(e)>-1||r.byPrefix.some((function(t){return e.startsWith(t+"__")})))?t.cacheReadyButNeedsToFlush=!0:t.removeSplit(e)})))}catch(t){it.error(t)}}}]),t}();ot.prototype.killLocally=et;var at=ot,st=function(){function t(e){$()(this,t),this.keys=e,this.flush()}return X()(t,[{key:"flush",value:function(){this.segmentCache={}}},{key:"addToSegment",value:function(t){var e=this.keys.buildSegmentNameKey(t);return this.segmentCache[e]=!0,!0}},{key:"removeFromSegment",value:function(t){var e=this.keys.buildSegmentNameKey(t);return delete this.segmentCache[e],!0}},{key:"resetSegments",value:function(t){var e,n=this,r=!1,i=Object.keys(this.segmentCache);if(0===t.length&&i.length===t.length)return r;if(i.length!==t.length)r=!0,this.segmentCache={},t.forEach((function(t){n.addToSegment(t)}));else{for(e=0;e<t.length&&this.isInSegment(t[e]);e++);e<t.length&&(r=!0,this.segmentCache={},t.forEach((function(t){n.addToSegment(t)})))}return r}},{key:"isInSegment",value:function(t){var e=this.keys.buildSegmentNameKey(t);return!0===this.segmentCache[e]}},{key:"setChangeNumber",value:function(){return!0}},{key:"getChangeNumber",value:function(){return-1}},{key:"registerSegment",value:function(){return!1}},{key:"registerSegments",value:function(){return!1}},{key:"getRegisteredSegments",value:function(){return[]}}]),t}(),ct=Object(s.b)("splitio-storage:localstorage"),ut=function(){function t(e){$()(this,t),this.keys=e}return X()(t,[{key:"addToSegment",value:function(t){var e=this.keys.buildSegmentNameKey(t);try{return localStorage.setItem(e,"1"),!0}catch(t){return ct.error(t),!1}}},{key:"removeFromSegment",value:function(t){var e=this.keys.buildSegmentNameKey(t);try{return localStorage.removeItem(e),!0}catch(t){return ct.error(t),!1}}},{key:"resetSegments",value:function(t){var e,n=this,r=!1,i=Object.keys(localStorage).reduce((function(t,e){var r=n.keys.extractSegmentName(e);return r&&t.push(r),t}),[]);if(0===t.length&&i.length===t.length)return r;if(i.length!==t.length)r=!0,i.forEach((function(t){return n.removeFromSegment(t)})),t.forEach((function(t){return n.addToSegment(t)}));else{for(e=0;e<t.length&&-1!==i.indexOf(t[e]);e++);e<t.length&&(r=!0,i.forEach((function(t){return n.removeFromSegment(t)})),t.forEach((function(t){return n.addToSegment(t)})))}return r}},{key:"isInSegment",value:function(t){return"1"===localStorage.getItem(this.keys.buildSegmentNameKey(t))}},{key:"setChangeNumber",value:function(){return!0}},{key:"getChangeNumber",value:function(){return-1}},{key:"registerSegment",value:function(){return!1}},{key:"registerSegments",value:function(){return!1}},{key:"getRegisteredSegments",value:function(){return[]}},{key:"flush",value:function(){ct.info("Flushing MySegments data from localStorage"),this.resetSegments([])}}]),t}(),lt=n(16),ft=n.n(lt),ht=function(){function t(){$()(this,t),this.queue=[]}return X()(t,[{key:"state",value:function(){return this.queue}},{key:"track",value:function(t){var e;return(e=this.queue).push.apply(e,ft()(t)),this}},{key:"clear",value:function(){return this.queue.length=0,this}},{key:"toJSON",value:function(){return this.queue}},{key:"isEmpty",value:function(){return 0===this.queue.length}}]),t}();var pt=function(t,e){for(var n=0,r=t.length-1,i=Math.floor((r+n)/2),o=n,a=r;t[i]!==e&&n<r;)e<t[i]?r=i-1:e>t[i]&&(n=i+1),i=Math.floor((r+n)/2);return i<o?i=o:i>a&&(i=a),e<t[i]&&i>o?i-1:i}.bind(null,[1,1.5,2.25,3.38,5.06,7.59,11.39,17.09,25.63,38.44,57.67,86.5,129.75,194.62,291.93,437.89,656.84,985.26,1477.89,2216.84,3325.26,4987.89,77481.83]),gt=function(){function t(){$()(this,t),this.clear()}return X()(t,[{key:"clear",value:function(){return this.counters={},this}},{key:"state",value:function(){return this.counters}},{key:"track",value:function(t,e){return void 0===this.counters[t]&&(this.counters[t]=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),this.counters[t][pt(e)]++,this}},{key:"isEmpty",value:function(){return 0===Object.keys(this.counters).length}},{key:"toJSON",value:function(){return this.counters}}]),t}(),dt=function(){function t(){$()(this,t),this.clear()}return X()(t,[{key:"clear",value:function(){return this.counters={},this}},{key:"state",value:function(){return this.counters}},{key:"track",value:function(t){return void 0===this.counters[t]?this.counters[t]=1:this.counters[t]++,this.counters[t]}},{key:"isEmpty",value:function(){return 0===Object.keys(this.counters).length}},{key:"toJSON",value:function(){return this.counters}}]),t}(),mt=function(){function t(e){var n=this;$()(this,t);var r=e.get(e.constants.SETTINGS),i=e.get(e.constants.EVENTS);this.onFullQueue=!1,this.maxQueue=r.scheduler.eventsQueueSize,this.queue=[],this.queueByteSize=0,o(i)?i.then((function(t){n.onFullQueue=t.flushAndResetTimer,n._checkForFlush()})):"function"==typeof i.flushAndResetTimer&&(this.onFullQueue=i.flushAndResetTimer)}return X()(t,[{key:"state",value:function(){return this.queue}},{key:"track",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.queueByteSize+=e,this.queue.push(t),this._checkForFlush(),!0}},{key:"clear",value:function(){return this.queue=[],this.queueByteSize=0,this}},{key:"toJSON",value:function(){return this.queue}},{key:"isEmpty",value:function(){return 0===this.queue.length}},{key:"_checkForFlush",value:function(){(this.queueByteSize>5242880||this.maxQueue>0&&this.queue.length>=this.maxQueue)&&this.onFullQueue&&this.onFullQueue()}}]),t}(),vt=/[^.]+$/,yt=/count\.([^/]+)$/,St=/latency\.([^/]+)\.bucket\.([0-9]+)$/,Tt=function(){function t(e){$()(this,t),this.settings=e}return X()(t,[{key:"buildSplitKey",value:function(t){return"".concat(this.settings.storage.prefix,".split.").concat(t)}},{key:"buildTrafficTypeKey",value:function(t){return"".concat(this.settings.storage.prefix,".trafficType.").concat(t)}},{key:"buildSplitsTillKey",value:function(){return"".concat(this.settings.storage.prefix,".splits.till")}},{key:"buildSplitsReady",value:function(){return"".concat(this.settings.storage.prefix,".splits.ready")}},{key:"isSplitKey",value:function(t){return Object(a.o)(t,"".concat(this.settings.storage.prefix,".split."))}},{key:"buildSegmentNameKey",value:function(t){return"".concat(this.settings.storage.prefix,".segment.").concat(t)}},{key:"buildSegmentTillKey",value:function(t){return"".concat(this.settings.storage.prefix,".segment.").concat(t,".till")}},{key:"buildRegisteredSegmentsKey",value:function(){return"".concat(this.settings.storage.prefix,".segments.registered")}},{key:"buildSegmentsReady",value:function(){return"".concat(this.settings.storage.prefix,".segments.ready")}},{key:"buildVersionablePrefix",value:function(){return"".concat(this.settings.storage.prefix,"/").concat(this.settings.version,"/").concat(this.settings.runtime.ip)}},{key:"buildImpressionsKey",value:function(){return"".concat(this.settings.storage.prefix,".impressions")}},{key:"buildEventsKey",value:function(){return"".concat(this.settings.storage.prefix,".events")}},{key:"buildLatencyKeyPrefix",value:function(){return"".concat(this.buildVersionablePrefix(),"/latency")}},{key:"buildLatencyKey",value:function(t,e){return"".concat(this.buildLatencyKeyPrefix(),".").concat(t,".bucket.").concat(e)}},{key:"buildCountKey",value:function(t){return"".concat(this.buildVersionablePrefix(),"/count.").concat(t)}},{key:"buildGaugeKey",value:function(t){return"".concat(this.buildVersionablePrefix(),"/gauge.").concat(t)}},{key:"searchPatternForCountKeys",value:function(){return"".concat(this.buildVersionablePrefix(),"/count.*")}},{key:"searchPatternForSplitKeys",value:function(){return"".concat(this.settings.storage.prefix,".split.*")}},{key:"searchPatternForLatency",value:function(){return"".concat(this.buildLatencyKeyPrefix(),".*")}},{key:"extractKey",value:function(t){var e=t.match(vt);if(e&&e.length)return e[0];throw"Invalid latency key provided"}},{key:"extractCounterName",value:function(t){var e=t.match(yt);if(e&&e.length)return e[1];throw"Invalid counter key provided"}},{key:"extractLatencyMetricNameAndBucket",value:function(t){var e=t.match(St);if(e&&e.length>2)return{metricName:e[1],bucketNumber:e[2]};throw"Invalid counter key provided"}}]),t}(),bt=n(7),Et=n.n(bt),_t=n(10),Ot=n.n(_t),Nt=n(6),kt=n.n(Nt);function At(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function(n){return Object(a.i)(n)?n[t]:e?void 0:n}}var Rt=At("matchingKey"),wt=At("bucketingKey",!0);function It(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=kt()(t);if(e){var i=kt()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ot()(this,n)}}var Ct=function(t){Et()(n,t);var e=It(n);function n(t){var r;return $()(this,n),(r=e.call(this,t)).regexSplitCacheKey=new RegExp("^".concat(r.settings.storage.prefix,"\\.(splits?|trafficType)\\.")),r}return X()(n,[{key:"buildSegmentNameKey",value:function(t){return"".concat(Rt(this.settings.core.key),".").concat(this.settings.storage.prefix,".segment.").concat(t)}},{key:"extractSegmentName",value:function(t){var e="".concat(Rt(this.settings.core.key),".").concat(this.settings.storage.prefix,".segment.");if(Object(a.o)(t,e))return t.substr(e.length)}},{key:"buildSplitsWithSegmentCountKey",value:function(){return"".concat(this.settings.storage.prefix,".splits.usingSegments")}},{key:"buildLastUpdatedKey",value:function(){return"".concat(this.settings.storage.prefix,".splits.lastUpdated")}},{key:"isSplitCacheKey",value:function(t){return this.regexSplitCacheKey.test(t)}},{key:"buildSplitsFilterQueryKey",value:function(){return"".concat(this.settings.storage.prefix,".splits.filterQuery")}}]),n}(Tt),Dt=function(t){var e=t.get(t.constants.SETTINGS);switch(e.storage.type){case"MEMORY":var n=new Tt(e);return{splits:new rt,segments:new st(n),impressions:new ht,metrics:new gt,count:new dt,events:new mt(t),shared:function(t){var e=new Tt(t);return{splits:this.splits,segments:new st(e),impressions:this.impressions,metrics:this.metrics,count:this.count,events:this.events,destroy:function(){this.splits=new rt,this.segments.flush()}}},destroy:function(){this.splits.flush(),this.segments.flush(),this.impressions.clear(),this.metrics.clear(),this.count.clear(),this.events.clear()}};case"LOCALSTORAGE":var r=new Ct(e),i=Date.now()-864e6;return{splits:new at(r,i,e.sync.__splitFiltersValidation),segments:new ut(r),impressions:new ht,metrics:new gt,count:new dt,events:new mt(t),shared:function(t){var e=new Ct(t);return{splits:this.splits,segments:new ut(e),impressions:this.impressions,metrics:this.metrics,count:this.count,events:this.events,destroy:function(){this.splits=new rt,this.segments=new st(e)}}},destroy:function(){this.splits=new rt,this.segments=new st(new Tt(e)),this.impressions.clear(),this.metrics.clear(),this.count.clear(),this.events.clear()}};default:throw new Error("Unsupported storage type")}},Lt=n(11),jt=n.n(Lt),Mt="init::timeout",Pt="init::ready",Ft="init::cache-ready",xt="state::splits-arrived",Kt="state::segments-arrived",Gt="state::splits-cache-loaded",Ut="state::update",Ht="state::check";var Wt=function(){var t=0,e=new jt.a;e.SDK_SPLITS_CACHE_LOADED=Gt,e.SDK_SPLITS_ARRIVED=xt;var n=0;function r(e,n){var r=new jt.a,i=0,o=0;return r.on(Ht,(function(){14!==o&&t+i===6?(o=14,r.emit(Pt)):14===o&&r.emit(Ut)})),e.on(xt,(function(e){e||(t=2),r.emit(Ht)})),e.once(Gt,(function(){setTimeout((function(){return r.emit(Ft)}),0)})),n.on(Kt,(function(){i=4,r.emit(Ht)})),r}return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=0,o=new jt.a;o.SDK_SEGMENTS_ARRIVED=Kt;var a=r(e,o);return t>0&&(i=setTimeout((function(){a.emit(Mt,"Split SDK emitted SDK_READY_TIMED_OUT event.")}),t),a.once(Pt,(function(){return clearTimeout(i)}))),a.SDK_READY=Pt,a.SDK_READY_FROM_CACHE=Ft,a.SDK_UPDATE=Ut,a.SDK_READY_TIMED_OUT=Mt,n++,{splits:e,segments:o,gate:a,destroy:function(){o.removeAllListeners(),a.removeAllListeners(),clearTimeout(i),n>0&&n--,0===n&&e.removeAllListeners()}}}},Bt={startup:{requestTimeoutBeforeReady:5,retriesOnFailureBeforeReady:1,readyTimeout:10,eventsFirstPushWindow:10}},Yt=n(12),qt=Object(s.b)("splitio-settings"),zt=function(t){var e=t.mode,n=t.storage,r=n.type,i=void 0===r?"MEMORY":r,o=n.options,a=void 0===o?{}:o,s=n.prefix;return s?s+=".SPLITIO":s="SPLITIO","localhost"===e?{type:"MEMORY",prefix:s}:(("MEMORY"!==i&&"LOCALSTORAGE"!==i||"LOCALSTORAGE"===i&&!Object(Yt.a)())&&(i="MEMORY",qt.warn("Invalid or unavailable storage. Fallbacking into MEMORY storage")),{type:i,options:a,prefix:s})},Vt=Object(s.b)("splitio-settings"),Qt=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=t.integrations;if(!Array.isArray(n)||0===n.length)return[];var r=n.filter((function(t){return t&&Object(a.j)(t.type)&&e.indexOf(t.type)>-1})),i=n.length-r.length;return i&&Vt.warn("".concat(i," integration ").concat(1===i?"item":"items"," at settings ").concat(1===i?"is":"are"," invalid: integration items must have a valid 'type' value")),r},Jt=function(t){return Qt(t,["GOOGLE_ANALYTICS_TO_SPLIT","SPLIT_TO_GOOGLE_ANALYTICS"])};var $t=function(t,e){if("localhost"===t)return"localhost";if(-1===[D,L,j].indexOf(e))throw Error("Invalid mode provided");return e},Zt=Object(s.b)("");function Xt(t,e){var n,r,i={validFilters:[],queryString:null,groupedFilters:{}};return t?e!==D?(Zt.warn("Factory instantiation: split filters have been configured but will have no effect if mode is not '".concat(D,"', since synchronization is being deferred to an external tool.")),i):Array.isArray(t)&&0!==t.length?(F.forEach((function(t){i.groupedFilters[t.type]=[]})),i.validFilters=t.filter((function(t,e){return t&&(n=t.type,F.some((function(t){return t.type===n})))&&Array.isArray(t.values)?(i.groupedFilters[t.type]=i.groupedFilters[t.type].concat(t.values),!0):(Zt.warn("Factory instantiation: split filter at position '".concat(e,"' is invalid. It must be an object with a valid filter type ('byName' or 'byPrefix') and a list of 'values'.")),!1);var n})),F.forEach((function(t){var e=t.type,n=t.maxLength;i.groupedFilters[e].length>0&&(i.groupedFilters[e]=function(t,e,n){var r=C(e,"Factory instantiation","".concat(t," filter"),"".concat(t," filter value"));if(r){if(r.length>n)throw new Error("".concat(n," unique values can be specified at most for '").concat(t,"' filter. You passed ").concat(r.length,". Please consider reducing the amount or using other filter."));r.sort()}return r||[]}(e,i.groupedFilters[e],n))})),i.queryString=(n=i.groupedFilters,r=[],F.forEach((function(t){var e=t.type,i=t.queryParam,o=n[e];o.length>0&&r.push(i+o.map((function(t){return encodeURIComponent(t)})).join(","))})),r.length>0?"&"+r.join("&"):null),Zt.debug("Factory instantiation: splits filtering criteria is '".concat(i.queryString,"'.")),i):(Zt.warn("Factory instantiation: splitFilters configuration must be a non-empty array of filter objects."),i):i}var te=n(17),ee=/^\/(testImpressions|metrics|events)/,ne=/^\/auth/,re=/^\/(sse|event-stream)/,ie={mode:D,core:{authorizationKey:void 0,key:void 0,trafficType:void 0,labelsEnabled:!0,IPAddressesEnabled:void 0},scheduler:{featuresRefreshRate:30,segmentsRefreshRate:60,metricsRefreshRate:120,impressionsRefreshRate:60,offlineRefreshRate:15,eventsPushRate:60,eventsQueueSize:500,authRetryBackoffBase:1,streamingReconnectBackoffBase:1},urls:{sdk:"https://sdk.split.io/api",events:"https://events.split.io/api",auth:"https://auth.split.io/api",streaming:"https://streaming.split.io"},storage:{type:"MEMORY"},debug:void 0,impressionListener:void 0,version:"".concat("javascript","-").concat(te.a),integrations:void 0,streamingEnabled:!0,sync:{splitFilters:void 0}};function oe(t){return Math.round(1e3*t)}function ae(t){var e,n=Object(a.k)({},ie,Bt,t);n.scheduler.featuresRefreshRate=oe(n.scheduler.featuresRefreshRate),n.scheduler.segmentsRefreshRate=oe(n.scheduler.segmentsRefreshRate),n.scheduler.metricsRefreshRate=oe(n.scheduler.metricsRefreshRate),n.scheduler.impressionsRefreshRate=oe(n.scheduler.impressionsRefreshRate),n.scheduler.offlineRefreshRate=oe(n.scheduler.offlineRefreshRate),n.scheduler.eventsPushRate=oe(n.scheduler.eventsPushRate),n.startup.requestTimeoutBeforeReady=oe(n.startup.requestTimeoutBeforeReady),n.startup.readyTimeout=oe(n.startup.readyTimeout),n.startup.eventsFirstPushWindow=oe(n.startup.eventsFirstPushWindow),n.mode=$t(n.core.authorizationKey,n.mode),n.storage=zt(n),"boolean"==typeof(e=n.debug)?e?s.a.enable():s.a.disable():"string"==typeof e&&s.a.setLogLevel(e),n.runtime=(n.core.IPAddressesEnabled,n.mode,{ip:!1,hostname:!1}),n.integrations=Jt(n),!1!==n.streamingEnabled&&(n.streamingEnabled=!0,n.scheduler.authRetryBackoffBase=oe(n.scheduler.authRetryBackoffBase),n.scheduler.streamingReconnectBackoffBase=oe(n.scheduler.streamingReconnectBackoffBase));var r=Xt(n.sync.splitFilters,n.mode);return n.sync.splitFilters=r.validFilters,n.sync.__splitFiltersValidation=r,n}var se={url:function(t){return ee.test(t)?"".concat(this.urls.events).concat(t):ne.test(t)?"".concat(this.urls.auth).concat(t):re.test(t)?"".concat(this.urls.streaming).concat(t):"".concat(this.urls.sdk).concat(t)},overrideKeyAndTT:function(t,e){return i()(Object.create(se),this,{core:i()({},this.core,{key:t,trafficType:e})})}},ce=function(t){return i()(Object.create(se),ae(t))},ue={COLLECTORS:"metrics_collectors",DESTROYED:"is_destroyed",EVENTS:"events_publisher",HAS_TIMEDOUT:"has_timedout",INTEGRATIONS_MANAGER:"integrations_manager",MY_SEGMENTS_CHANGE_WORKER:"my_segments_change_worker",PRODUCER:"producer",READINESS:"readiness_gate",READY:"is_ready",READY_FROM_CACHE:"is_ready_from_cache",SETTINGS:"settings",STATUS_MANAGER:"status_manager",STORAGE:"storage"},le=function(){function t(){$()(this,t),this._map={},this.constants=ue}return X()(t,[{key:"get",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("string"==typeof t&&("string"!=typeof t||t.length)){var n=this._map[t];if(void 0!==n)return n;if(!e){var r,i=new Promise((function(t){return r=t}));return i.manualResolve=r,this._map[t]=i,i}}}},{key:"getAll",value:function(){return i()({},this._map)}},{key:"put",value:function(t,e){var n=this;if("string"!=typeof t||"string"==typeof t&&!t.length||void 0===e)return!1;var r=this._map[t];return(void 0===r||"function"==typeof r.manualResolve)&&(o(r)&&r.manualResolve&&r.manualResolve(e),o(e)&&e.then((function(e){return n._map[t]=e,e})).catch((function(e){return n._map[t]=void 0,e})),this._map[t]=e,!0)}}]),t}(),fe=function(t){return Object(a.i)(t)?{matchingKey:t.matchingKey,bucketingKey:t.bucketingKey}:{matchingKey:t,bucketingKey:t}},he=n(8),pe=n.n(he),ge=n(5),de=n(9),me=n.n(de);var ve="object"===("undefined"==typeof performance?"undefined":me()(performance))&&"function"==typeof performance.now?performance.now.bind(performance):Date.now;var ye,Se=function(){var t=ve();return function(){return Math.round(ve()-t)}},Te=new ge.b("[TIME TRACKER]",{showLevel:!1}),be={},Ee={SDK_READY:"Getting ready - Split SDK",SDK_GET_TREATMENT:"SDK - Get Treatment",SDK_GET_TREATMENTS:"SDK - Get Treatments",SDK_GET_TREATMENT_WITH_CONFIG:"SDK - Get Treatment with config",SDK_GET_TREATMENTS_WITH_CONFIG:"SDK - Get Treatments with config",SPLITS_READY:"Getting ready - Splits",SEGMENTS_READY:"Getting ready - Segments",METRICS_PUSH:"Pushing - Metrics",IMPRESSIONS_PUSH:"Pushing - Impressions",EVENTS_PUSH:"Pushing - Events",MY_SEGMENTS_FETCH:"Fetching - My Segments",SEGMENTS_FETCH:"Fetching - Segments",SPLITS_FETCH:"Fetching - Splits"},_e=(ye={},pe()(ye,Ee.SDK_READY,{collector:"client",method:"ready"}),pe()(ye,Ee.SDK_GET_TREATMENT,{collector:"client",method:"getTreatment"}),pe()(ye,Ee.SDK_GET_TREATMENTS,{collector:"client",method:"getTreatments"}),pe()(ye,Ee.SDK_GET_TREATMENT_WITH_CONFIG,{collector:"client",method:"getTreatmentWithConfig"}),pe()(ye,Ee.SDK_GET_TREATMENTS_WITH_CONFIG,{collector:"client",method:"getTreatmentsWithConfig"}),pe()(ye,Ee.MY_SEGMENTS_FETCH,{collector:"mySegments",method:"latency"}),pe()(ye,Ee.SEGMENTS_FETCH,{collector:"segmentChanges",method:"latency"}),pe()(ye,Ee.SPLITS_FETCH,{collector:"splitChanges",method:"latency"}),ye),Oe=function(t,e){return"string"==typeof e?t+e:t},Ne=function(t,e){var n=_e[t];return!(!n||!e)&&e[n.collector]},ke=function(t,e){var n=_e[t];return!(!n||!e)&&e[n.method]},Ae={__attachToPromise:function(t,e,n,r){var i=this;return t.then((function(t){return i.stop(e,r),n&&n.count&&n.count(t.status),t})).catch((function(t){throw i.stop(e,r),n&&n.countException&&n.countException(),t}))},start:function(t,e,n){var r,i=Object(a.t)(),s=Ne(t,e);o(n)?r=this.__attachToPromise(n,t,s,i):(r=this.stop.bind(this,t,i),_e[t]&&!s&&(r.setCollectorForTask=this.setCollectorForTask.bind(this,t,i)));var c=Oe(t,i),u=ke(t,s);return be[c]={cb:u,timer:Se()},r},setCollectorForTask:function(t,e,n){var r=Ne(t,n);if(r){var i=Oe(t,e);be[i].cb=ke(t,r)}},stop:function(t,e){var n=Oe(t,e),r=be[n];if(r){var i=r.timer();return Te.debug("[".concat(t,"] took ").concat(i,"ms to finish.")),r.cb&&r.cb(i),delete be[n],i}},TaskNames:Ee},Re={ALL:1,SEGMENT:2,WHITELIST:3,EQUAL_TO:4,GREATER_THAN_OR_EQUAL_TO:5,LESS_THAN_OR_EQUAL_TO:6,BETWEEN:7,UNDEFINED:8,EQUAL_TO_SET:9,CONTAINS_ANY_OF_SET:10,CONTAINS_ALL_OF_SET:11,PART_OF_SET:12,ENDS_WITH:13,STARTS_WITH:14,CONTAINS_STRING:15,IN_SPLIT_TREATMENT:16,EQUAL_TO_BOOLEAN:17,MATCHES_STRING:18},we={BOOLEAN:"BOOLEAN",STRING:"STRING",NUMBER:"NUMBER",SET:"SET",DATETIME:"DATETIME",NOT_SPECIFIED:"NOT_SPECIFIED"};var Ie=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.segmentName},Ce=function(){function t(){var e=this;$()(this,t),this.__setData__=[];var n=arguments[0];Array.isArray(n)&&n.forEach((function(t){e.add(t)}))}return X()(t,[{key:"clear",value:function(){this.__setData__.length&&(this.__setData__.length=0)}},{key:"add",value:function(t){return this.has(t)||this.__setData__.push(t),this}},{key:"delete",value:function(t){var e=this.__setData__.indexOf(t);return-1!==e&&(this.__setData__.splice(e,1),!0)}},{key:"has",value:function(t){return-1!==this.__setData__.indexOf(t)}},{key:"forEach",value:function(t){var e=arguments[1];if("function"!=typeof t)throw new TypeError(t+" is not a function");for(var n=0;n<this.__setData__.length;n++){var r=this.__setData__[n];t.call(e,r,r,this)}}},{key:"size",get:function(){return this.__setData__.length}}]),t}();function De(t){return t instanceof Ce?t.__setData__.slice():Array.from(t)}var Le=Array.from&&Set&&Set.prototype.values?Set:Ce;var je=function(t){return new Le(t.whitelist)};var Me=function(t){return t.whitelist};var Pe=function(t){return t.value};function Fe(t){return new Date(t).setUTCHours(0,0,0,0)}function xe(t){return new Date(t).setUTCSeconds(0,0)}var Ke=function(t){var e=t.map((function(t){var e=t.matcherType,n=t.negate,r=t.keySelector,i=t.userDefinedSegmentMatcherData,o=t.whitelistMatcherData,a=t.unaryNumericMatcherData,s=t.betweenMatcherData,c=t.dependencyMatcherData,u=t.booleanMatcherData,l=t.stringMatcherData,f=r&&r.attribute,h=function(t){switch(t){case"ALL_KEYS":return Re.ALL;case"IN_SEGMENT":return Re.SEGMENT;case"WHITELIST":return Re.WHITELIST;case"EQUAL_TO":return Re.EQUAL_TO;case"GREATER_THAN_OR_EQUAL_TO":return Re.GREATER_THAN_OR_EQUAL_TO;case"LESS_THAN_OR_EQUAL_TO":return Re.LESS_THAN_OR_EQUAL_TO;case"BETWEEN":return Re.BETWEEN;case"EQUAL_TO_SET":return Re.EQUAL_TO_SET;case"CONTAINS_ANY_OF_SET":return Re.CONTAINS_ANY_OF_SET;case"CONTAINS_ALL_OF_SET":return Re.CONTAINS_ALL_OF_SET;case"PART_OF_SET":return Re.PART_OF_SET;case"ENDS_WITH":return Re.ENDS_WITH;case"STARTS_WITH":return Re.STARTS_WITH;case"CONTAINS_STRING":return Re.CONTAINS_STRING;case"IN_SPLIT_TREATMENT":return Re.IN_SPLIT_TREATMENT;case"EQUAL_TO_BOOLEAN":return Re.EQUAL_TO_BOOLEAN;case"MATCHES_STRING":return Re.MATCHES_STRING;default:return Re.UNDEFINED}}(e),p=we.STRING,g=void 0;return h===Re.SEGMENT?g=Ie(i):h===Re.WHITELIST?g=je(o):h===Re.EQUAL_TO?(g=Pe(a),p=we.NUMBER,"DATETIME"===a.dataType&&(g=Fe(g),p=we.DATETIME)):h===Re.GREATER_THAN_OR_EQUAL_TO||h===Re.LESS_THAN_OR_EQUAL_TO?(g=Pe(a),p=we.NUMBER,"DATETIME"===a.dataType&&(g=xe(g),p=we.DATETIME)):h===Re.BETWEEN?(g=s,p=we.NUMBER,"DATETIME"===s.dataType&&(g.start=xe(g.start),g.end=xe(g.end),p=we.DATETIME)):h===Re.EQUAL_TO_SET||h===Re.CONTAINS_ANY_OF_SET||h===Re.CONTAINS_ALL_OF_SET||h===Re.PART_OF_SET?(g=Me(o),p=we.SET):h===Re.STARTS_WITH||h===Re.ENDS_WITH||h===Re.CONTAINS_STRING?g=Me(o):h===Re.IN_SPLIT_TREATMENT?(g=c,p=we.NOT_SPECIFIED):h===Re.EQUAL_TO_BOOLEAN?(p=we.BOOLEAN,g=u):h===Re.MATCHES_STRING&&(g=l),{attribute:f,negate:n,type:h,value:g,dataType:p}}));return-1===Object(a.c)(e,(function(t){return t.type===Re.UNDEFINED}))?e:[]};function Ge(t,e){if(!(this instanceof Ge))return new Ge(t,e);if(100!==t[t.length-1])throw new RangeError("Provided invalid dataset as input");this._ranges=t,this._treatments=e}Ge.parse=function(t){var e=t.reduce((function(t,e){var n=e.size,r=e.treatment;return t.ranges.push(t.inc+=n),t.treatments.push(r),t}),{inc:0,ranges:[],treatments:[]});return new Ge(e.ranges,e.treatments)},Ge.prototype.getTreatmentFor=function(t){if(t<0||t>100)throw new RangeError("Please provide a value between 0 and 100");var e=Object(a.c)(this._ranges,(function(e){return t<=e}));return this._treatments[e]};var Ue=Ge,He=Object(s.b)("splitio-engine:matcher");function We(t){return He.debug("[allMatcher] is always true"),null!=t}var Be=function(){return We},Ye=Object(s.b)("splitio-engine:matcher");var qe=function(t,e){return function(n){var r=e.segments.isInSegment(t,n);return o(r)?r.then((function(e){return Ye.debug("[asyncSegmentMatcher] evaluated ".concat(t," / ").concat(n," => ").concat(r)),e})):Ye.debug("[segmentMatcher] evaluated ".concat(t," / ").concat(n," => ").concat(r)),r}},ze=Object(s.b)("splitio-engine:matcher");var Ve=function(t){return function(e){var n=t.has(e);return ze.debug("[whitelistMatcher] evaluated ".concat(e," in [").concat(De(t).join(","),"] => ").concat(n)),n}},Qe=Object(s.b)("splitio-engine:matcher");var Je=function(t){return function(e){var n=e===t;return Qe.debug("[equalToMatcher] is ".concat(e," equal to ").concat(t,"? ").concat(n)),n}},$e=Object(s.b)("splitio-engine:matcher");var Ze=function(t){return function(e){var n=e>=t;return $e.debug("[greaterThanEqualMatcher] is ".concat(e," greater than ").concat(t,"? ").concat(n)),n}},Xe=Object(s.b)("splitio-engine:matcher");var tn=function(t){return function(e){var n=e<=t;return Xe.debug("[lessThanEqualMatcher] is ".concat(e," less than ").concat(t,"? ").concat(n)),n}},en=Object(s.b)("splitio-engine:matcher");var nn=function(t){return function(e){var n=e>=t.start&&e<=t.end;return en.debug("[betweenMatcher] is ".concat(e," between ").concat(t.start," and ").concat(t.end,"? ").concat(n)),n}},rn=Object(s.b)("splitio-engine:matcher");var on=function(t){return function(e){for(var n=e.length===t.length,r=function(r){Object(a.c)(t,(function(t){return t===e[r]}))<0&&(n=!1)},i=0;i<e.length&&n;i++)r(i);return rn.debug("[equalToSetMatcher] is ".concat(e," equal to set ").concat(t,"? ").concat(n)),n}},an=Object(s.b)("splitio-engine:matcher");var sn=function(t){return function(e){var n=!0;if(e.length<t.length)n=!1;else for(var r=function(r){Object(a.c)(e,(function(e){return e===t[r]}))<0&&(n=!1)},i=0;i<t.length&&n;i++)r(i);return an.debug("[containsAllMatcher] ".concat(e," contains all elements of ").concat(t,"? ").concat(n)),n}},cn=Object(s.b)("splitio-engine:matcher");var un=function(t){return function(e){for(var n=!1,r=function(r){Object(a.c)(e,(function(e){return e===t[r]}))>=0&&(n=!0)},i=0;i<t.length&&!n;i++)r(i);return cn.debug("[containsAnyMatcher] ".concat(e," contains at least an element of ").concat(t,"? ").concat(n)),n}},ln=Object(s.b)("splitio-engine:matcher");var fn=function(t){return function(e){for(var n=e.length<=t.length,r=function(r){Object(a.c)(t,(function(t){return t===e[r]}))<0&&(n=!1)},i=0;i<e.length&&n;i++)r(i);return ln.debug("[partOfMatcher] ".concat(e," is part of ").concat(t,"? ").concat(n)),n}},hn=Object(s.b)("splitio-engine:matcher");var pn=function(t){return function(e){var n=t.some((function(t){return Object(a.o)(e,t)}));return hn.debug("[startsWithMatcher] ".concat(e," starts with ").concat(t,"? ").concat(n)),n}},gn=Object(s.b)("splitio-engine:matcher");var dn=function(t){return function(e){var n=t.some((function(t){return Object(a.a)(e,t)}));return gn.debug("[endsWithMatcher] ".concat(e," ends with ").concat(t,"? ").concat(n)),n}},mn=Object(s.b)("splitio-engine:matcher");var vn=function(t){return function(e){var n=t.some((function(t){return Object(a.j)(e)&&e.indexOf(t)>-1}));return mn.debug("[containsStringMatcher] ".concat(e," contains ").concat(t,"? ").concat(n)),n}},yn=Object(s.b)("splitio-engine:matcher");function Sn(t,e,n){var r=!1;return Array.isArray(e)&&(r=-1!==e.indexOf(t.treatment)),yn.debug('[dependencyMatcher] Parent split "'.concat(n,'" evaluated to "').concat(t.treatment,'" with label "').concat(t.label,'". ').concat(n," evaluated treatment is part of [").concat(e,"] ? ").concat(r,".")),r}var Tn=function(t,e){var n=t.split,r=t.treatments;return function(t,i){var a=t.key,s=t.attributes;yn.debug('[dependencyMatcher] will evaluate parent split: "'.concat(n,'" with key: ').concat(JSON.stringify(a)," ").concat(s?"\n attributes: ".concat(JSON.stringify(s)):""));var c=i(a,n,s,e);return o(c)?c.then((function(t){return Sn(t,r,n)})):Sn(c,r,n)}},bn=Object(s.b)("splitio-engine:matcher");var En=function(t){return function(e){var n=t===e;return bn.debug("[booleanMatcher] ".concat(t," === ").concat(e)),n}},_n=Object(s.b)("splitio-engine:matcher");var On=function(t){return function(e){var n;try{n=new RegExp(t)}catch(e){return _n.debug("[stringMatcher] ".concat(t," is an invalid regex")),!1}var r=n.test(e);return _n.debug("[stringMatcher] does ".concat(e," matches with ").concat(t,"? ").concat(r?"yes":"no")),r}};var Nn=function(t,e){var n,r=t.type,i=t.value;return r===Re.ALL?n=Be(i):r===Re.SEGMENT?n=qe(i,e):r===Re.WHITELIST?n=Ve(i):r===Re.EQUAL_TO?n=Je(i):r===Re.GREATER_THAN_OR_EQUAL_TO?n=Ze(i):r===Re.LESS_THAN_OR_EQUAL_TO?n=tn(i):r===Re.BETWEEN?n=nn(i):r===Re.EQUAL_TO_SET?n=on(i):r===Re.CONTAINS_ANY_OF_SET?n=un(i):r===Re.CONTAINS_ALL_OF_SET?n=sn(i):r===Re.PART_OF_SET?n=fn(i):r===Re.STARTS_WITH?n=pn(i):r===Re.ENDS_WITH?n=dn(i):r===Re.CONTAINS_STRING?n=vn(i):r===Re.IN_SPLIT_TREATMENT?n=Tn(i,e):r===Re.EQUAL_TO_BOOLEAN?n=En(i):r===Re.MATCHES_STRING&&(n=On(i)),n},kn=Object(s.b)("splitio-engine:sanitize"),An=Re,Rn=we;function wn(t,e){return{key:t,attributes:e}}var In=function(t,e,n,r){var i,o,s,c=function(t,e){switch(t){case An.EQUAL_TO:return"DATETIME"===e?Fe:void 0;case An.GREATER_THAN_OR_EQUAL_TO:case An.LESS_THAN_OR_EQUAL_TO:case An.BETWEEN:return"DATETIME"===e?xe:void 0;case An.IN_SPLIT_TREATMENT:return wn;default:return}}(t,n);switch(n){case Rn.NUMBER:case Rn.DATETIME:o=e,s=Object(a.p)(o),i=isNaN(s)?void 0:s;break;case Rn.STRING:i=function(t){var e=t;Object(a.i)(t)&&(e=t.matchingKey?t.matchingKey:void 0);var n=Object(a.q)(e);return n||void 0}(e);break;case Rn.SET:i=function(t){var e=Array.isArray(t)?Object(a.s)(t.map((function(t){return t+""}))):[];return e.length?e:void 0}(e);break;case Rn.BOOLEAN:i=function(t){if(!0===t||!1===t)return t;if("string"==typeof t){var e=t.toLocaleLowerCase();if("true"===e)return!0;if("false"===e)return!1}}(e);break;case Rn.NOT_SPECIFIED:i=e;break;default:i=void 0}return c&&(i=c(i,r)),kn.debug("Attempted to sanitize [".concat(e,"] which should be of type [").concat(n,"]. \n Sanitized and processed value => [").concat(i instanceof Object?JSON.stringify(i):i,"]")),i},Cn=Object(s.b)("splitio-engine:value");var Dn=function(t,e,n){var r=e.attribute,i=function(t,e,n){var r=void 0;return e?n?(r=n[e],Cn.debug("Extracted attribute [".concat(e,"], [").concat(r,"] will be used for matching."))):Cn.warn("Defined attribute [".concat(e,"], no attributes received.")):r=t,r}(t,r,n),o=In(e.type,i,e.dataType,n);return void 0!==o?o:void Cn.warn("Value ".concat(i," ").concat(r?"for attribute ".concat(r," "):0,"doesn't match with expected type."))};function Ln(t){return e=function(t){return(t=Number(t))<0?Math.ceil(t):Math.floor(t)}(t),n=Math.pow(2,32),e-Math.floor(e/n)*n;var e,n}function jn(t){var e=Ln(t);return e>=Math.pow(2,31)?e-Math.pow(2,32):e}function Mn(t,e){for(var n=0,r=0;r<t.length;r++)n=jn(jn(31*n)+t.charCodeAt(r));return jn(n^e)}var Pn=function(t,e){return Math.abs(Mn(t,e)%100)+1},Fn=n(13),xn=n.n(Fn),Kn=xn.a.stringSource,Gn=xn.a.stringDestination,Un=xn.a.encodeUTF16toUTF8;function Hn(t,e){return(65535&t)*e+(((t>>>16)*e&65535)<<16)}function Wn(t,e){return t<<e|t>>>32-e}function Bn(t,e){e=e||0;for(var n,r=(t=t||"").length%4,i=t.length-r,o=e,a=0,s=3432918353,c=461845907,u=0;u<i;u+=4)a=Hn(a=255&t.charCodeAt(u)|(255&t.charCodeAt(u+1))<<8|(255&t.charCodeAt(u+2))<<16|(255&t.charCodeAt(u+3))<<24,s),a=Hn(a=Wn(a,15),c),o=Hn(o=Wn(o^=a,13),5)+3864292196;switch(a=0,r){case 3:a^=(255&t.charCodeAt(u+2))<<16;case 2:a^=(255&t.charCodeAt(u+1))<<8;case 1:a=Hn(a^=255&t.charCodeAt(u),s),o^=a=Hn(a=Wn(a,15),c)}return o^=t.length,n=o,n=Hn(n^=n>>>16,2246822507),n=Hn(n^=n>>>13,3266489909),(o=n^=n>>>16)>>>0}function Yn(t,e){return Bn((Un(Kn(t),n=Gn()),n()),e>>>0);var n}var qn={hash:Yn,bucket:function(t,e){return Math.abs(Yn(t,e)%100)+1}},zn=Object(s.b)("splitio-engine");function Vn(t){return 2===t?qn.bucket:Pn}var Qn={getTreatment:function(t,e,n,r){var i=Vn(r)(t,e),o=n.getTreatmentFor(i);return zn.debug("[engine] using algo ".concat(2!==r?"legacy":"murmur"," bucket ").concat(i," for key ").concat(t," using seed ").concat(e," - treatment ").concat(o)),o},shouldApplyRollout:function(t,e,n,r){if(t<100&&Vn(r)(e,n)>t)return!1;return!0}};function Jn(t,e,n,r,i,o){if(t)return{treatment:Qn.getTreatment(e,n,r,o),label:i}}var $n=function(t,e,n,r){return function(i,a,s,c,u,l,f){if("ROLLOUT"===r&&!Qn.shouldApplyRollout(s,i.bucketingKey,c,f))return{treatment:void 0,label:"not in split"};var h=t(i,l,u);return o(h)?h.then((function(t){return Jn(t,i.bucketingKey,a,e,n,f)})):Jn(h,i.bucketingKey,a,e,n,f)}},Zn=Object(s.b)("splitio-engine:combiner");function Xn(){return Zn.error("Invalid Split provided, no valid conditions found"),{treatment:M,label:"exception"}}function tr(t){for(var e=t.length,n=0;n<e;n++){var r=t[n];if(void 0!==r)return Zn.debug("Treatment found: ".concat(r.treatment)),r}Zn.debug("All predicates evaluated, no treatment found.")}var er=function(t){return!Array.isArray(t)||Array.isArray(t)&&0===t.length?Xn:function(e,n,r,i,s,c,u){var l=t.map((function(t){return t(e,n,r,i,u,s,c)}));return-1!==Object(a.c)(l,o)?Promise.all(l).then((function(t){return tr(t)})):tr(l)}},nr=Object(s.b)("splitio-engine:combiner");function rr(t){for(var e,n=0,r=t.length;n<r&&t[n];n++);return e=n===r,nr.debug("[andCombiner] evaluates to ".concat(e)),e}var ir=function(t){return function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=t.map((function(t){return t.apply(void 0,n)}));return-1!==Object(a.c)(i,o)?Promise.all(i).then(rr):rr(i)}};var or=function(t,e){for(var n=[],r=0;r<t.length;r++){var i=t[r],a=i.matcherGroup.matchers,s=i.partitions,c=i.label,u=i.conditionType,l=(a=Ke(a)).map((function(t){var n=Nn(t,e);return function(e,r,i){var a=Dn(e,t,r),s=void 0!==a&&n(a,i);return o(s)?s.then((function(e){return Boolean(e^t.negate)})):Boolean(s^t.negate)}}));if(0===l.length){n=[];break}n.push($n(ir(l),Ue.parse(s),c,u))}return er(n)};function ar(t,e){return{treatment:Object(a.e)(t,"treatment",e),label:Object(a.e)(t,"label","default rule")}}function sr(t,e){if(!(this instanceof sr))return new sr(t,e);var n;this.baseInfo=t,this.evaluator=e,"string"!=typeof(n=this).baseInfo.defaultTreatment&&(n.baseInfo.defaultTreatment=M)}sr.parse=function(t,e){var n=t.conditions,r=or(n,e);return new sr(i()({},t),r)},sr.prototype.getKey=function(){return this.baseInfo.name},sr.prototype.getTreatment=function(t,e,n){var r,i,a,s=this.baseInfo,c=s.killed,u=s.seed,l=s.defaultTreatment,f=s.trafficAllocation,h=s.trafficAllocationSeed,p=s.algo;try{r=fe(t)}catch(t){return{treatment:M,label:"exception"}}if(this.isGarbage())i=M,a="archived";else{if(!c){var g=this.evaluator(r,u,f,h,e,p,n);return o(g)?g.then((function(t){return ar(t,l)})):ar(g,l)}i=l,a="killed"}return{treatment:i,label:a}},sr.prototype.isGarbage=function(){return"ARCHIVED"===this.baseInfo.status},sr.prototype.getChangeNumber=function(){return this.baseInfo.changeNumber};var cr=sr,ur={treatment:M,label:"exception",config:null};function lr(t,e,n,r){var i;try{i=r.splits.getSplit(e)}catch(t){return Promise.resolve(ur)}return o(i)?i.then((function(e){return hr(e,t,n,r)})):hr(i,t,n,r)}function fr(t,e,n,r){var i,a={};try{i=r.splits.fetchMany(e)}catch(t){return e.forEach((function(t){a[t]=ur})),Promise.resolve(a)}return o(i)?i.then((function(i){return pr(e,i,t,n,r)})):pr(e,i,t,n,r)}function hr(t,e,n,r){var i={treatment:M,label:"definition not found",config:null};if(t){var s=JSON.parse(t),c=cr.parse(s,r);if(i=c.getTreatment(e,n,lr),o(i))return i.then((function(t){return t.changeNumber=c.getChangeNumber(),t.config=Object(a.e)(s,"configurations.".concat(t.treatment),null),t}));i.changeNumber=c.getChangeNumber(),i.config=Object(a.e)(s,"configurations.".concat(i.treatment),null)}return i}function pr(t,e,n,r,i){var a={},s=[];return t.forEach((function(t){var c=hr(e[t],n,r,i);o(c)?s.push(c.then((function(e){a[t]=e}))):a[t]=c})),s.length>0?Promise.all(s).then((function(){return a})):a}var gr=Object(s.b)("splitio-client:impression-tracker");var dr=function(t){var e=t.get(t.constants.STORAGE).impressions,n=t.get(t.constants.SETTINGS),r=n.impressionListener,a=t.get(t.constants.INTEGRATIONS_MANAGER,!0),s=n.runtime,c=s.ip,u=s.hostname,l=n.version;return{track:function(t,n){var s=e.track([t]);if(o(s)&&s.catch((function(t){gr.error("Could not store impression. Error: ".concat(t))})),r||a){var f={impression:i()({},t),attributes:n,ip:c,hostname:u,sdkLanguageVersion:l};setTimeout((function(){a&&a.handleImpression(f);try{r&&r.logImpression(f)}catch(t){gr.error("Impression listener logImpression method threw: ".concat(t,"."))}}),0)}}}},mr=Object(s.b)("splitio-client:impressions-tracker");var vr=function(t){var e=t.get(t.constants.STORAGE).impressions,n=t.get(t.constants.SETTINGS),r=n.impressionListener,a=t.get(t.constants.INTEGRATIONS_MANAGER,!0),s=n.runtime,c=s.ip,u=s.hostname,l=n.version,f=[];return{queue:function(t,e){f.push({impression:t,attributes:e})},track:function(){var t=f.length,n=f.splice(0,t),s=e.track(n.map((function(t){return t.impression})));if(o(s)&&s.then((function(){mr.debug("Successfully stored ".concat(t," impression").concat(1===t?"":"s","."))})).catch((function(e){mr.error("Could not store impressions bulk with ".concat(t," impression").concat(1===t?"":"s",". Error: ").concat(e))})),r||a)for(var h=function(t){var e={impression:i()({},n[t].impression),attributes:n[t].attributes,ip:c,hostname:u,sdkLanguageVersion:l};setTimeout((function(){a&&a.handleImpression(e);try{r&&r.logImpression(e)}catch(t){mr.error("Impression listener logImpression method threw: ".concat(t,"."))}}),0)},p=0;p<t;p++)h(p)}}},yr=Object(s.b)("splitio-client:event-tracker");var Sr=function(t){var e=t.get(t.constants.STORAGE).events,n=t.get(t.constants.INTEGRATIONS_MANAGER,!0);function r(t,e){var r=t.eventTypeId,o=t.trafficTypeName,a=t.key,s=t.value,c=t.timestamp,u=t.properties,l='event of type "'.concat(r,'" for traffic type "').concat(o,'". Key: ').concat(a,". Value: ").concat(s,". Timestamp: ").concat(c,". ").concat(u?"With properties.":"With no properties.");return e?(yr.info("Successfully qeued ".concat(l)),n&&setTimeout((function(){var e=i()({},t);t.properties&&(e.properties=i()({},t.properties)),n.handleEvent(e)}),0)):yr.warn("Failed to queue ".concat(l)),e}return{track:function(t,n){var i=e.track(t,n);return o(i)?i.then(r.bind(null,t)):r(t,i)}}},Tr=Object(s.b)("splitio-client");var br=function(t){var e=t.get(t.constants.STORAGE),n=t.get(t.constants.COLLECTORS),r=dr(t),i=vr(t),a=Sr(t);function s(t,i,a){var s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=Ae.TaskNames[s?"SDK_GET_TREATMENT_WITH_CONFIG":"SDK_GET_TREATMENT"],l=Ae.start(c,n),f=lr(t,i,a,e);return o(f)?f.then((function(e){return u(e,i,t,a,l,r.track,s,"getTreatment".concat(s?"withConfig":""))})):u(f,i,t,a,l,r.track,s,"getTreatment".concat(s?"withConfig":""))}function c(t,r,a){var s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=Ae.TaskNames[s?"SDK_GET_TREATMENTS_WITH_CONFIG":"SDK_GET_TREATMENTS"],l=Ae.start(c,n),f={},h=function(e){return Object.keys(e).forEach((function(n){f[n]=u(e[n],n,t,a,!1,i.queue,s,"getTreatments".concat(s?"withConfig":""))})),i.track(),l(),f},p=fr(t,r,a,e);return o(p)?p.then((function(t){return h(t)})):h(p)}function u(e,n,r,i){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0,c=arguments.length>7?arguments[7]:void 0,u=t.get(t.constants.READY,!0)||t.get(t.constants.READY_FROM_CACHE,!0),l=Rt(r),f=wt(r);u||(e={treatment:M,label:"not ready"});var h=e,p=h.treatment,g=h.label,d=h.changeNumber,m=h.config,v=void 0===m?null:m;return Tr.info("Split: ".concat(n,". Key: ").concat(l,". Evaluation: ").concat(p,". Label: ").concat(g)),w(t,n,g,c)&&(Tr.info("Queueing corresponding impression."),a({feature:n,keyName:l,treatment:p,time:Date.now(),bucketingKey:f,label:g,changeNumber:d},i)),o&&o(),s?{treatment:p,config:v}:p}return{getTreatment:s,getTreatmentWithConfig:function(t,e,n){return s(t,e,n,!0)},getTreatments:c,getTreatmentsWithConfig:function(t,e,n){return c(t,e,n,!0)},track:function(e,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1024,c=Rt(e),u=Date.now(),l={eventTypeId:r,trafficTypeName:n,value:i,timestamp:u,key:c,properties:o};return H(n,t,"track"),a.track(l,s)}}};var Er=function(t,e,n){var r="REDIS"!==t.get(t.constants.SETTINGS).storage.type,o=br(t),s=o.getTreatment,c=o.getTreatmentWithConfig,u=o.getTreatments,l=o.getTreatmentsWithConfig,h=o.track;function p(n,r,i,o){var s,c,u=Object(a.o)(o,"getTreatments"),l=e?n:N(n,o),h=u?C(r,o):R(r,o),p=(s=i,c=o,Object(a.i)(s)||null==s?s:(f.error("".concat(c,": attributes must be a plain object.")),!1)),g=B(t);return Y(t,o),{valid:g&&l&&h&&!1!==p,key:l,splitOrSplits:h,attributes:p}}return o.getTreatment=function(t,e,n){var i=p(t,e,n,"getTreatment");return i.valid?s(i.key,i.splitOrSplits,i.attributes):r?M:Promise.resolve(M)},o.getTreatmentWithConfig=function(t,e,n){var o=p(t,e,n,"getTreatmentWithConfig");return o.valid?c(o.key,o.splitOrSplits,o.attributes):r?i()({},P):Promise.resolve(i()({},P))},o.getTreatments=function(t,e,n){var i=p(t,e,n,"getTreatments");if(i.valid)return u(i.key,i.splitOrSplits,i.attributes);var o={};return i.splitOrSplits&&i.splitOrSplits.forEach((function(t){return o[t]=M})),r?o:Promise.resolve(o)},o.getTreatmentsWithConfig=function(t,e,n){var o=p(t,e,n,"getTreatmentsWithConfig");if(o.valid)return l(o.key,o.splitOrSplits,o.attributes);var a={};return o.splitOrSplits&&o.splitOrSplits.forEach((function(t){return a[t]=i()({},P)})),r?a:Promise.resolve(a)},o.track=function(i,o,a,s,c){var u=e?i:N(i,"track"),l=n?o:G(o,"track"),f=g(a,"track"),p=m(s,"track"),d=E(c,"track"),v=d.properties,y=d.size;return B(t)&&u&&l&&f&&!1!==p&&!1!==v?h(u,l,f,p,v,y):!r&&Promise.resolve(!1)},o};var _r=function(t){var e,n=t.get(t.constants.SETTINGS),r=Object(a.e)(n,"core.key",void 0),i=Object(a.e)(n,"core.trafficType",void 0);"localhost"===n.mode&&void 0===r?n.core.key="localhost_key":n.core.key=N(r,"Client instantiation");var o=[n.core.key];if(void 0!==i){var s=G(i,"Client instantiation");n.core.trafficType=s,o.push(s)}var c=Er(t,!0,o.length>1);return c.isBrowserClient=!0,c.getTreatment=c.getTreatment.bind(c,n.core.key),c.getTreatmentWithConfig=c.getTreatmentWithConfig.bind(c,n.core.key),c.getTreatments=c.getTreatments.bind(c,n.core.key),c.getTreatmentsWithConfig=c.getTreatmentsWithConfig.bind(c,n.core.key),c.track=(e=c.track).bind.apply(e,[c].concat(o)),c};var Or=function(t,e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];var o,a=!1;function s(){for(var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e,r=arguments.length,i=new Array(r>1?r-1:0),c=1;c<r;c++)i[c-1]=arguments[c];a||(o=setTimeout((function(){t.apply(void 0,i.concat([s]))}),n))}function c(){clearTimeout(o),o=void 0,a=!0}return c.reset=function(){clearTimeout(o),o=void 0,s.apply(void 0,[e].concat(r))},t.apply(void 0,r.concat([s])),c},Nr=function(t,e){return e=e||{},new Promise((function(n,r){var i=new XMLHttpRequest,o=[],a=[],s={},c=function(){return{ok:2==(i.status/100|0),statusText:i.statusText,status:i.status,url:i.responseURL,text:function(){return Promise.resolve(i.responseText)},json:function(){return Promise.resolve(JSON.parse(i.responseText))},blob:function(){return Promise.resolve(new Blob([i.response]))},clone:c,headers:{keys:function(){return o},entries:function(){return a},get:function(t){return s[t.toLowerCase()]},has:function(t){return t.toLowerCase()in s}}}};for(var u in i.open(e.method||"get",t,!0),i.onload=function(){i.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,(function(t,e,n){o.push(e=e.toLowerCase()),a.push([e,n]),s[e]=s[e]?s[e]+","+n:n})),n(c())},i.onerror=r,i.withCredentials="include"==e.credentials,e.headers)i.setRequestHeader(u,e.headers[u]);i.send(e.body||null)}))};var kr=n(18);function Ar(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=kt()(t);if(e){var i=kt()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ot()(this,n)}}var Rr=function(t){Et()(n,t);var e=Ar(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Split Error";return $()(this,n),(t=e.call(this,r)).message=r,t}return n}(n.n(kr)()(Error)),wr=function(t){Et()(n,t);var e=Ar(n);function n(t){return $()(this,n),e.call(this,t||"Split Timeout Error")}return n}(Rr),Ir=function(t){Et()(n,t);var e=Ar(n);function n(t,r){var i;return $()(this,n),(i=e.call(this,t||"Split Network Error")).statusCode=r,i}return n}(Rr),Cr=Object(s.b)("splitio-services:service");function Dr(t){var e=t.url;return(window&&window.fetch||Nr)(e,t).then((function(t){if(!t.ok)throw{response:t};return t})).catch((function(n){var r=n.response,i="";if(r)switch(r.status){case 404:i="Invalid API key or resource not found.";break;default:i=r.statusText}else i=n.message;throw r&&403===r.status||Cr[t.logErrorsAsInfo?"info":"error"]("Response status is not OK. Status: ".concat(r?r.status:"NO_STATUS",". URL: ").concat(e,". Message: ").concat(i)),new Ir(i,r&&r.status)}))}var Lr=Dr;var jr=function(t,e,n){var r=t.core.authorizationKey,o=t.version,a=t.runtime,s=a.ip,c=a.hostname,u={},l={};return u.Accept="application/json",u["Content-Type"]="application/json",u.Authorization="Bearer ".concat(r),u.SplitSDKVersion=o,s&&(u.SplitSDKMachineIP=s),c&&(u.SplitSDKMachineName=c),i()({headers:u,url:t.url(e)},l,n)};function Mr(t){var e=[],n=t.toJSON();return Object(a.d)(n,(function(t,n){e.push({name:n,delta:t})})),e}var Pr=Dr;function Fr(t,e){return jr(t,"/testImpressions/bulk",i()({method:"POST"},e))}function xr(t,e){var n=e.core.labelsEnabled,r=Object(a.g)(t.state(),"feature"),i=[];return Object(a.d)(r,(function(t,e){i.push({testName:e,keyImpressions:t.map((function(t){var e={keyName:t.keyName,treatment:t.treatment,time:t.time,changeNumber:t.changeNumber};return n&&(e.label=t.label),t.bucketingKey&&(e.bucketingKey=t.bucketingKey),e}))})})),i}function Kr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=kt()(t);if(e){var i=kt()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Ot()(this,n)}}var Gr=function(){function t(e){$()(this,t),this.storage=e,this.latency=this.latency.bind(this),this.count=this.count.bind(this),this.countException=this.countException.bind(this)}return X()(t,[{key:"latency",value:function(t){this.storage.metrics.track("".concat(this.metricType,".time"),t)}},{key:"count",value:function(t){this.storage.count.track("".concat(this.metricType,".status.").concat(t))}},{key:"countException",value:function(){this.storage.count.track("".concat(this.metricType,".exception"))}}]),t}(),Ur=function(t){Et()(n,t);var e=Kr(n);function n(t){var r;return $()(this,n),(r=e.call(this,t)).metricType="segmentChangeFetcher",r}return n}(Gr),Hr=function(t){Et()(n,t);var e=Kr(n);function n(t){var r;return $()(this,n),(r=e.call(this,t)).metricType="splitChangeFetcher",r}return n}(Gr),Wr=function(t){Et()(n,t);var e=Kr(n);function n(t){var r;return $()(this,n),(r=e.call(this,t)).metricType="mySegmentsFetcher",r}return n}(Gr),Br=function(){function t(e){$()(this,t),this.storage=e,this.ready=this.ready.bind(this),this.getTreatment=this.getTreatment.bind(this),this.getTreatments=this.getTreatments.bind(this),this.getTreatmentWithConfig=this.getTreatmentWithConfig.bind(this),this.getTreatmentsWithConfig=this.getTreatmentsWithConfig.bind(this)}return X()(t,[{key:"ready",value:function(t){this.storage.metrics.track("sdk.ready",t)}},{key:"getTreatment",value:function(t){this.storage.metrics.track("sdk.getTreatment",t)}},{key:"getTreatments",value:function(t){this.storage.metrics.track("sdk.getTreatments",t)}},{key:"getTreatmentWithConfig",value:function(t){this.storage.metrics.track("sdk.getTreatmentWithConfig",t)}},{key:"getTreatmentsWithConfig",value:function(t){this.storage.metrics.track("sdk.getTreatmentsWithConfig",t)}}]),t}(),Yr=Object(s.b)("splitio-metrics"),qr=function(t){var e=0,n=t.get(t.constants.SETTINGS),r=t.get(t.constants.STORAGE),o=function(){if(r.metrics.isEmpty()&&r.count.isEmpty())return Promise.resolve();Yr.info("Pushing metrics");var t,e,o,s=Ae.start(Ae.TaskNames.METRICS_PUSH),c=r.metrics.isEmpty()?null:Lr(function(t,e){return jr(t,"/metrics/times",i()({method:"POST"},e,{logErrorsAsInfo:!0}))}(n,{body:JSON.stringify((t=r.metrics,e=[],o=t.toJSON(),Object(a.d)(o,(function(t,n){e.push({name:n,latencies:t})})),e))})).then((function(){return r.metrics.clear()})).catch((function(){return r.metrics.clear()})),u=r.count.isEmpty()?null:Lr(function(t,e){return jr(t,"/metrics/counters",i()({method:"POST"},e,{logErrorsAsInfo:!0}))}(n,{body:JSON.stringify(Mr(r.count))})).then((function(){return r.count.clear()})).catch((function(){return r.count.clear()}));return Promise.all([c,u]).then((function(t){return s(),t}))},s=function(){if(r.impressions.isEmpty())return Promise.resolve();var t=r.impressions.queue.length;Yr.info("Pushing ".concat(t," impressions"));var i=Ae.start(Ae.TaskNames.IMPRESSIONS_PUSH);return Pr(Fr(n,{body:JSON.stringify(xr(r.impressions,n))})).then((function(){e=0,r.impressions.clear()})).catch((function(n){e?(Yr.warn("Droping ".concat(t," impressions after retry. Reason ").concat(n,".")),e=0,r.impressions.clear()):(e++,Yr.warn("Failed to push ".concat(t," impressions, keeping data to retry on next iteration. Reason ").concat(n,".")))})).then((function(){return i()}))},c=!1,u=!1;return{start:function(){c=Or((function(t){return s().then((function(){return t()}))}),n.scheduler.impressionsRefreshRate),u=Or((function(t){return o().then((function(){return t()}))}),n.scheduler.metricsRefreshRate)},flush:function(){return s()},stop:function(){c&&c(),u&&u()},collectors:{segmentChanges:new Ur(r),splitChanges:new Hr(r),mySegments:new Wr(r),client:new Br(r)}}},zr=Dr;function Vr(t,e){return jr(t,"/events/bulk",i()({method:"POST"},e))}var Qr=Object(s.b)("splitio-events"),Jr=function(t){var e=t.get(t.constants.SETTINGS),n=t.get(t.constants.STORAGE),r=function(){if(n.events.isEmpty())return Promise.resolve();Qr.info("Pushing ".concat(n.events.state().length," queued events."));var t=Ae.start(Ae.TaskNames.EVENTS_PUSH),r=JSON.stringify(n.events.toJSON()),i=function(){return t()};return n.events.clear(),zr(Vr(e,{body:r})).then(i).catch(i)},i=!1,o=!1,a=function(){return o=Or((function(t){return r().then((function(){return t()}))}),e.scheduler.eventsPushRate)};return{start:function(){e.startup.eventsFirstPushWindow>0?i=setTimeout(a,e.startup.eventsFirstPushWindow):a()},flush:function(){return r()},stop:function(){i&&clearTimeout(i),o&&o()},flushAndResetTimer:function(){return Qr.info("Flushing events and reseting timer."),o&&o.reset(),r()}}},$r=Dr;function Zr(t){return"users="+encodeURIComponent(t)}function Xr(t){var e,n=t.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),r=decodeURIComponent((e=n,atob(e)).split("").map((function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)})).join(""));return JSON.parse(r)}function ti(t,e){return $r(function(t,e){var n="/auth";if(e){var r=e.map(Zr).join("&");r&&(n+="?"+r)}return jr(t,n)}(t,e)).then((function(t){return t.json()})).then((function(t){if(t.token){var e=Xr(t.token);if("number"!=typeof e.iat||"number"!=typeof e.exp)throw'token properties "issuedAt" (iat) or "expiration" (exp) are missing or invalid';var n=JSON.parse(e["x-ably-capability"]);return i()({decodedToken:e,channels:n},t)}return t}))}function ei(){return window&&"function"==typeof window.EventSource?window.EventSource:void 0}var ni=function(){function t(e,n,r){$()(this,t),this.baseMillis=n||t.DEFAULT_BASE_MILLIS,this.maxMillis=r||t.DEFAULT_MAX_MILLIS,this.attempts=0,this.cb=e}return X()(t,[{key:"scheduleCall",value:function(){var t=this,e=Math.min(this.baseMillis*Math.pow(2,this.attempts),this.maxMillis);return this.timeoutID&&clearTimeout(this.timeoutID),this.timeoutID=setTimeout((function(){t.cb()}),e),this.attempts++,e}},{key:"reset",value:function(){this.attempts=0,this.timeoutID&&(clearTimeout(this.timeoutID),this.timeoutID=0)}}]),t}();ni.DEFAULT_BASE_MILLIS=1e3,ni.DEFAULT_MAX_MILLIS=18e5;var ri=ni,ii=function(){function t(e,n){$()(this,t),this.mySegmentsStorage=e,this.mySegmentsProducer=n,this.maxChangeNumber=0,this.segmentList=void 0,this.currentChangeNumber=-1,this.put=this.put.bind(this),this.__handleMySegmentUpdateCall=this.__handleMySegmentUpdateCall.bind(this),this.backoff=new ri(this.__handleMySegmentUpdateCall)}return X()(t,[{key:"__handleMySegmentUpdateCall",value:function(){var t=this;if(this.maxChangeNumber>this.currentChangeNumber){this.handleNewEvent=!1;var e=this.maxChangeNumber;this.mySegmentsProducer.synchronizeMySegments(this.segmentList).then((function(n){!1!==n&&(t.currentChangeNumber=Math.max(t.currentChangeNumber,e)),t.handleNewEvent?t.__handleMySegmentUpdateCall():t.backoff.scheduleCall()}))}}},{key:"put",value:function(t,e){t<=this.currentChangeNumber||t<=this.maxChangeNumber||(this.maxChangeNumber=t,this.handleNewEvent=!0,this.backoff.reset(),this.segmentList=e,this.mySegmentsProducer.isSynchronizingMySegments()||this.__handleMySegmentUpdateCall())}}]),t}(),oi=function(){function t(e,n,r){$()(this,t),this.splitStorage=e,this.splitProducer=n,this.maxChangeNumber=0,this.splitsEventEmitter=r,this.put=this.put.bind(this),this.killSplit=this.killSplit.bind(this),this.__handleSplitUpdateCall=this.__handleSplitUpdateCall.bind(this),this.backoff=new ri(this.__handleSplitUpdateCall)}return X()(t,[{key:"__handleSplitUpdateCall",value:function(){var t=this;this.maxChangeNumber>this.splitStorage.getChangeNumber()&&(this.handleNewEvent=!1,this.splitProducer.synchronizeSplits().then((function(){t.handleNewEvent?t.__handleSplitUpdateCall():t.backoff.scheduleCall()})))}},{key:"put",value:function(t){t<=this.splitStorage.getChangeNumber()||t<=this.maxChangeNumber||(this.maxChangeNumber=t,this.handleNewEvent=!0,this.backoff.reset(),this.splitProducer.isSynchronizingSplits()||this.__handleSplitUpdateCall())}},{key:"killSplit",value:function(t,e,n){var r=this;this.splitStorage.killLocally(e,n,t).then((function(e){e&&r.splitsEventEmitter.emit(r.splitsEventEmitter.SDK_SPLITS_ARRIVED,!0),r.put(t)}))}}]),t}(),ai=/^control_/,si=function(){function t(e,n){$()(this,t),this.EventSource=e,this.streamingUrl=n.url("/sse"),this.reopen=this.reopen.bind(this)}return X()(t,null,[{key:"getInstance",value:function(e){var n=ei();if(n)return new t(n,e)}}]),X()(t,[{key:"setEventHandler",value:function(t){this.handler=t}},{key:"open",value:function(t){this.close(),this.authToken=t;var e=Object.keys(t.channels).map((function(t){var e=ai.test(t)?"[?occupancy=metrics.publishers]":"";return encodeURIComponent(e+t)})).join(","),n="".concat(this.streamingUrl,"?channels=").concat(e,"&accessToken=").concat(t.token,"&v=").concat("1.1","&heartbeats=true");this.connection=new this.EventSource(n),this.handler&&(this.connection.onopen=this.handler.handleOpen,this.connection.onmessage=this.handler.handleMessage,this.connection.onerror=this.handler.handleError)}},{key:"close",value:function(){this.connection&&this.connection.close()}},{key:"reopen",value:function(){this.open(this.authToken)}}]),t}(),ci="STREAMING_DISABLED",ui="STREAMING_PAUSED",li="STREAMING_RESUMED";var fi=/control_pri$/;var hi=Object(s.b)("splitio-sync:sse-handler");function pi(t){var e,n,r,i,o,s=(e=t,n=-1,r=!0,i=-1,o=!0,{handleOpen:function(){e.emit("PUSH_CONNECT")},isStreamingUp:function(){return o&&r},handleOccupancyEvent:function(t,i,a){fi.test(i)&&a>n&&(n=a,o&&(0===t&&r?e.emit("PUSH_DISCONNECT"):0===t||r||e.emit("PUSH_CONNECT")),r=0!==t)},handleControlEvent:function(t,n,a){fi.test(n)&&a>i&&(i=a,t===ci?e.emit("PUSH_DISABLED"):r&&(t===ui&&o?e.emit("PUSH_DISCONNECT"):t!==li||o||e.emit("PUSH_CONNECT")),o=t===li)}});return{handleOpen:function(){s.handleOpen()},handleError:function(e){var n=e;try{n=function(t){return Object(a.j)(t.data)&&(t.parsedData=JSON.parse(t.data)),t}(e)}catch(t){hi.warn("Error parsing SSE error notification: ".concat(t))}t.emit("SSE_ERROR",n)},handleMessage:function(e){var n;try{n=function(t){var e=JSON.parse(t.data);return e.parsedData=JSON.parse(e.data),e.name&&"[meta]occupancy"===e.name&&(e.parsedData.type="OCCUPANCY"),e}(e)}catch(t){return void hi.warn("Error parsing new SSE message notification: ".concat(t))}var r=n,i=r.parsedData,o=r.data,a=r.channel,c=r.timestamp;if(hi.debug("New SSE message received, with data: ".concat(o,".")),s.isStreamingUp()||"OCCUPANCY"===i.type||"CONTROL"===i.type)switch(i.type){case"SPLIT_UPDATE":t.emit("SPLIT_UPDATE",i.changeNumber);break;case"SEGMENT_UPDATE":t.emit("SEGMENT_UPDATE",i.changeNumber,i.segmentName);break;case"MY_SEGMENTS_UPDATE":t.emit("MY_SEGMENTS_UPDATE",i,a);break;case"SPLIT_KILL":t.emit("SPLIT_KILL",i.changeNumber,i.splitName,i.defaultTreatment);break;case"OCCUPANCY":s.handleOccupancyEvent(i.metrics.publishers,a,c);break;case"CONTROL":s.handleControlEvent(i.controlType,a,c)}}}}function gi(t){return e=qn.hash(t,0).toString(),btoa(e);var e}var di=Object(s.b)("splitio-sync:push-manager");function mi(t,e){if(n=di,ei()?"function"==typeof atob&&"function"==typeof btoa||(n.warn('"atob" and "btoa" functions for Base64 encoding are not available. Falling back to polling mode.'),0):(n.warn("EventSource API is not available. Falling back to polling mode."),0)){var n,r=new jt.a,o=t.get(t.constants.READINESS).splits,a=t.get(t.constants.SETTINGS),s=t.get(t.constants.STORAGE),c=si.getInstance(a),u=pi(r);c.setEventHandler(u);var l,f={},h=[],p=!1,g=new ri(T,a.scheduler.authRetryBackoffBase),d=new ri(c.reopen,a.scheduler.streamingReconnectBackoffBase),m=0;r.on("PUSH_DISCONNECT",E),r.on("PUSH_DISABLED",(function(){b(),r.emit("PUSH_DISCONNECT")})),r.on("SSE_ERROR",(function(t){var e;c.close(),e=!t.parsedData||400!==t.parsedData.statusCode&&401!==t.parsedData.statusCode?d.scheduleCall():g.scheduleCall();var n=t.parsedData&&t.parsedData.message;di.error("Fail to connect to streaming".concat(n?', with error message: "'.concat(n,'"'):"",". Attempting to reconnect in ").concat(e/1e3," seconds.")),r.emit("PUSH_DISCONNECT")}));var v=t.get(t.constants.PRODUCER),y=new oi(s.splits,v,o);if(h.push(y),r.on("SPLIT_KILL",y.killSplit),r.on("SPLIT_UPDATE",y.put),e)r.on("MY_SEGMENTS_UPDATE",(function(n,r){var i=r.split("_")[2],o=f[i];if(o&&e[o]){var a=e[o].get(t.constants.MY_SEGMENTS_CHANGE_WORKER,!0);a&&a.put(n.changeNumber,n.includesPayload?n.segmentList?n.segmentList:[]:void 0)}}));else{var S=new ii(s.segments,v);h.push(S),r.on("SEGMENT_UPDATE",S.put)}return i()(Object.create(r),{stop:function(){b(),E()},start:T,startNewClient:function(t,e){var n=gi(t),r=e.get(e.constants.STORAGE),i=e.get(e.constants.PRODUCER);f[n]||(f[n]=t,p=!0);var o=new ii(r.segments,i);h.push(o),e.put(e.constants.MY_SEGMENTS_CHANGE_WORKER,o),setTimeout((function(){p&&(p=!1,T())}),0)},removeClient:function(t){var e=gi(t);delete f[e]}})}function T(){l=!1,di.info("Connecting to push streaming.");var t=e?Object.keys(e):void 0;ti(a,t).then((function(n){if(!l){if(g.reset(),d.reset(),!n.pushEnabled)return di.info("Streaming is not available. Switching to polling mode."),void r.emit("PUSH_DISCONNECT");if(!(t&&t.length<Object.keys(e).length)){var i=n.decodedToken;c.open(n),function(t,e){m&&clearTimeout(m);var n=e-t-600;di.info("Refreshing streaming token in ".concat(n," seconds.")),m=setTimeout(T,1e3*n)}(i.iat,i.exp)}}})).catch((function(t){if(!l){c.close(),r.emit("PUSH_DISCONNECT");var e='Failed to authenticate for streaming. Error: "'.concat(t.message,'".');if(t.statusCode>=400&&t.statusCode<500)di.error(e);else{var n=g.scheduleCall();di.error("".concat(e,". Attempting to reauthenticate in ").concat(n/1e3," seconds."))}}}))}function b(){l=!0,di.info("Disconnecting from push streaming."),c.close(),m&&clearTimeout(m),g.reset(),d.reset()}function E(){h.forEach((function(t){return t.backoff.reset()}))}}var vi=Object(s.b)("splitio-producer:task"),yi=function(t,e){var n=Object(a.f)(t),r=!1;return{start:function(){r||(vi.debug("Starting ".concat(n," refreshing each ").concat(e)),r=Or((function(e){vi.debug("Running ".concat(n)),t().then((function(){return e()}))}),e))},stop:function(){vi.debug("Stopping ".concat(n)),r&&r(),r=!1},isRunning:function(){return!!r}}};var Si=function(t,e){return t<1?e:new Promise((function(n,r){var i=setTimeout((function(){r(new wr("Operation timed out because it exceeded the configured time limit of ".concat(t,"ms.")))}),t);e.then((function(t){clearTimeout(i),n(t)}),(function(t){clearTimeout(i),r(t)}))}))},Ti=Dr;function bi(t,e,n){return jr(t,"/splitChanges?since=".concat(e).concat(n||""))}var Ei=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,o=t.sync.__splitFiltersValidation.queryString,a=Ti(bi(t,e,o)),s=n||i;return a=Ae.start(Ae.TaskNames.SPLITS_FETCH,!!s&&r,a),n&&(a=Si(t.startup.requestTimeoutBeforeReady,a)),a.then((function(t){return t.json().catch((function(t){throw new Rr(t.message)}))}))},_i=function(t){var e=new Le;return t.forEach((function(t){t.matcherGroup.matchers.forEach((function(t){var n=t.matcherType,r=t.userDefinedSegmentMatcherData;"IN_SEGMENT"===n&&e.add(r.segmentName)}))})),e},Oi=Object(s.b)("splitio-producer:split-changes");function Ni(t){var e=t.reduce((function(t,e){return"ACTIVE"===e.status?(t.added.push([e.name,JSON.stringify(e)]),_i(e.conditions).forEach((function(e){t.segments.add(e)}))):t.removed.push(e.name),t}),{added:[],removed:[],segments:new Le});return e.segments=De(e.segments),e}var ki=Dr;function Ai(t){return jr(t,"/mySegments/".concat(Rt(t.core.key)))}var Ri=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=ki(Ai(t));return r=Ae.start(Ae.TaskNames.MY_SEGMENTS_FETCH,!!e&&n,r),e&&(r=Si(t.startup.requestTimeoutBeforeReady,r)),r.then((function(t){return t.json().catch((function(t){throw new Rr(t.message)}))})).then((function(t){return t.mySegments.map((function(t){return t.name}))}))},wi=Object(s.b)("splitio-producer:my-segments");var Ii=Object(s.b)("splitio-producer:mySegmentsHandler"),Ci=function(t){var e=t.get(t.constants.SETTINGS),n=t.get(t.constants.STORAGE).splits,r=t.get(t.constants.READINESS),i=r.splits,o=r.segments,a=function(t){var e=t.getAll(),n=e[t.constants.SETTINGS],r=e[t.constants.READINESS],i=e[t.constants.STORAGE],o=e[t.constants.COLLECTORS],a=r.segments,s=!0,c=!0;function u(t){var e=i.segments.resetSegments(t);i.splits.usesSegments()&&(e||s)&&(s=!1,a.emit(a.SDK_SEGMENTS_ARRIVED))}return function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1?arguments[1]:void 0;return(r?new Promise((function(t){u(r),t()})):Ri(n,c,o).then((function(t){c=!1,u(t)}))).catch((function(r){return r instanceof Rr||setTimeout((function(){throw r}),0),c&&n.startup.retriesOnFailureBeforeReady>e?(e+=1,wi.warn("Retrying download of segments #".concat(e,". Reason: ").concat(r)),t(e)):(c=!1,!1)}))}}(t),s=yi(u,e.scheduler.segmentsRefreshRate);i.on(i.SDK_SPLITS_ARRIVED,(function(){if(!l)return;var t=n.usesSegments();t!==s.isRunning()&&(Ii.info("Turning segments data polling ".concat(t?"ON":"OFF",".")),t?s.start():s.stop())})),n.usesSegments()?i.once(i.SDK_SPLITS_ARRIVED,f):setTimeout(f,0);var c=!1;function u(t){return c=!0,a(0,t).then((function(t){return c=!1,t}))}var l=!1;function f(){t.get(t.constants.READY,!0)||n.usesSegments()||o.emit(o.SDK_SEGMENTS_ARRIVED)}return{start:function(){l=!0,n.usesSegments()&&s.start()},stop:function(){l=!1,s.stop()},isRunning:function(){return l},isSynchronizingMySegments:function(){return c},synchronizeMySegments:u}},Di=Object(s.b)("splitio-producer:updater"),Li=function(t){var e=t.get(t.constants.SETTINGS),n=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t.getAll(),r=n[t.constants.SETTINGS],i=n[t.constants.READINESS],a=n[t.constants.STORAGE],s=n[t.constants.COLLECTORS],c=i.splits,u=!0,l=!0;return function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;function i(i){Oi.debug("Spin up split update using since = ".concat(i));var o=Ei(r,i,u,s,e).then((function(t){u=!1;var e=Ni(t.splits);return Oi.debug("New splits ".concat(e.added.length)),Oi.debug("Removed splits ".concat(e.removed.length)),Oi.debug("Segment names collected ".concat(e.segments)),Promise.all([a.splits.setChangeNumber(t.till),a.splits.addSplits(e.added),a.splits.removeSplits(e.removed),a.segments.registerSegments(e.segments)]).then((function(){(i!==t.till||l)&&(l=!1,c.emit(c.SDK_SPLITS_ARRIVED))}))})).catch((function(e){return e instanceof Rr||(setTimeout((function(){throw e}),0),u=!1),Oi.warn("Error while doing fetch of Splits. ".concat(e)),u&&r.startup.retriesOnFailureBeforeReady>n?(n+=1,Oi.info("Retrying download of splits #".concat(n,". Reason: ").concat(e)),t(n)):(u=!1,!1)}));return u&&a.splits.checkCache()&&c.emit(c.SDK_SPLITS_CACHE_LOADED),o}var f=a.splits.getChangeNumber(),h=o(f)?f.then(i):Promise.resolve(f);return h.then(i)}}(t),r=yi(s,e.scheduler.featuresRefreshRate),i=Ci(t),a=!1;function s(){return a=!0,n().then((function(t){return a=!1,t}))}return{start:function(){Di.info("Starting BROWSER producer"),r.start(),i.start()},stop:function(){Di.info("Stopping BROWSER producer"),r.stop(),i.stop()},isRunning:r.isRunning,isSynchronizingSplits:function(){return a},synchronizeSplits:s,isSynchronizingMySegments:i.isSynchronizingMySegments,synchronizeMySegments:i.synchronizeMySegments}},ji=Object(s.b)("splitio-sync:sync-manager");var Mi=Object(s.b)("splitio-client:cleanup"),Pi=function(){function t(e){$()(this,t),this.storage=e.get(e.constants.STORAGE),this.settings=e.get(e.constants.SETTINGS),this.flushData=this.flushData.bind(this)}return X()(t,[{key:"start",value:function(){window&&window.addEventListener&&(Mi.debug("Registering flush handler when unload page event is triggered."),window.addEventListener("unload",this.flushData))}},{key:"stop",value:function(){window&&window.removeEventListener&&(Mi.debug("Deregistering flush handler when unload page event is triggered."),window.removeEventListener("unload",this.flushData))}},{key:"flushData",value:function(){this._flushImpressions(),this._flushEvents()}},{key:"_flushImpressions",value:function(){var t=this.storage.impressions;if(!t.isEmpty()){var e=this.settings.url("/testImpressions/beacon"),n=xr(t,this.settings);this._sendBeacon(e,n)||Pr(Fr(this.settings,{body:JSON.stringify(n)})),t.clear()}}},{key:"_flushEvents",value:function(){var t=this.storage.events;if(!t.isEmpty()){var e=this.settings.url("/events/beacon"),n=t.toJSON();this._sendBeacon(e,n)||zr(Vr(this.settings,{body:JSON.stringify(n)})),t.clear()}}},{key:"_sendBeacon",value:function(t,e){if(navigator&&navigator.sendBeacon){var n=JSON.stringify({entries:e,token:this.settings.core.authorizationKey,sdk:this.settings.version});return navigator.sendBeacon(t,n)}return!1}}]),t}(),Fi={};var xi=function(t,e,n){var r,o=!!n,s=t.get(t.constants.SETTINGS),c=t.get(t.constants.READINESS),u=t.get(t.constants.STORAGE),f=t.get(t.constants.STATUS_MANAGER),h=c.gate,p=c.splits,g=c.segments,d=h.SDK_READY,m=o?void 0:qr(t),v=o?void 0:Jr(t),y=o?void 0:new Pi(t);switch(s.mode){case L:case D:t.put(t.constants.COLLECTORS,m&&m.collectors),o?r=Fi[s.core.authorizationKey].shared(t):(r=function(t){var e={},n=t.get(t.constants.SETTINGS),r=l(!1,t),i=n.streamingEnabled?mi(t,e):void 0,o=t.get(t.constants.PRODUCER);function s(){o.isRunning()?ji.info("Streaming couldn't connect. Continue periodic fetch of data."):(ji.info("Streaming not available. Starting periodic fetch of data."),Object(a.d)(e,(function(t){t.get(t.constants.PRODUCER).start()})))}function c(){o.isRunning()&&(ji.info("PUSH (re)connected. Syncing and stopping periodic fetch of data."),Object(a.d)(e,(function(t){t.get(t.constants.PRODUCER).stop()}))),u()}function u(){t.get(t.constants.PRODUCER).synchronizeSplits(),Object(a.d)(e,(function(t){t.get(t.constants.PRODUCER).synchronizeMySegments()}))}function l(t,n){var r=t?Ci(n):Li(n),l=n.get(n.constants.SETTINGS),f=Object(a.q)(Rt(l.core.key));return n.put(n.constants.PRODUCER,r),e[f]&&ji.warn("A client with the same user key has already been created. Only the new instance will be properly synchronized."),e[f]=n,{start:function(){i?(t?o.isRunning()?r.start():r.synchronizeMySegments():(u(),i.on("PUSH_CONNECT",c),i.on("PUSH_DISCONNECT",s)),i.startNewClient(f,n)):r.start()},stop:function(){e[f]&&(delete e[f],i&&(i.removeClient(f),t||i.stop()),r.isRunning()&&r.stop())}}}return r.shared=l.bind(null,!0),r}(t),Fi[s.core.authorizationKey]=r);break;case j:t.put(t.constants.READY_FROM_CACHE,!0)}if(e&&r&&!o){var S=e.sdkReadyTracker,T=e.splitsReadyTracker,b=e.segmentsReadyTracker;S.setCollectorForTask(m.collectors),h.once(d,S),p.once(p.SDK_SPLITS_ARRIVED,T),g.once(g.SDK_SEGMENTS_ARRIVED,b)}r&&r.start(),m&&m.start(),v&&t.put(t.constants.EVENTS,v)&&v.start(),t.put(t.constants.COLLECTORS,n);var E=i()(Object.create(f),_r(t),{destroy:function(){return r&&r.stop(),m&&m.stop(),v&&v.stop(),Promise.all([m&&m.flush(),v&&v.flush()]).then((function(){c.destroy(),y&&y.stop(),u.destroy&&u.destroy(),t.put(t.constants.DESTROYED,!0),o||(l(s.core.authorizationKey),delete Fi[s.core.authorizationKey])}))}});return!o&&y.start(E.destroy),{api:E,metricCollectors:m&&m.collectors}};function Ki(t){var e=t.treatment;return t.keys?{conditionType:"WHITELIST",matcherGroup:{combiner:"AND",matchers:[{keySelector:null,matcherType:"WHITELIST",negate:!1,whitelistMatcherData:{whitelist:Object(a.j)(t.keys)?[t.keys]:t.keys}}]},partitions:[{treatment:e,size:100}],label:"whitelisted ".concat(e)}:{conditionType:"ROLLOUT",matcherGroup:{combiner:"AND",matchers:[{keySelector:null,matcherType:"ALL_KEYS",negate:!1}]},partitions:[{treatment:e,size:100}],label:"default rule"}}var Gi={emptyMock:1};function Ui(t){var e=Object.keys(t);return e.length!==Object.keys(Gi).length?(Gi=t,!0):e.some((function(e){var n,r,i=!Gi[e],o=(n=Gi[e],r=t[e],me()(n)!==me()(r)||("string"==typeof n?n!==r:n.treatment!==r.treatment||n.config!==r.config)),a=i||o;return a&&(Gi=t),a}))}var Hi=function(t){var e=t.features||{};if(!Ui(e))return!1;var n={};return Object(a.d)(e,(function(t,e){var r=t,i=null;Object(a.i)(t)&&(r=t.treatment,i=t.config||i);var o={};null!==i&&(o[r]=i),n[e]={conditions:[Ki({treatment:r})],configurations:o}})),n},Wi=Object(s.b)("splitio-producer:offline");var Bi=function(t,e){var n=e.getAll(),r=n[e.constants.SETTINGS],i=n[e.constants.READINESS],o=n[e.constants.STORAGE];return function(){var e=[],n=null,s={};try{s=t(r)}catch(t){n=t,Wi.error("There was an issue loading the mock Splits data, no changes will be applied to the current cache. ".concat(t))}return!n&&s?(Wi.debug("Splits data: "),Wi.debug(JSON.stringify(s)),Object(a.d)(s,(function(t,n){e.push([n,JSON.stringify({name:n,status:"ACTIVE",killed:!1,trafficAllocation:100,defaultTreatment:"control",conditions:t.conditions||[],configurations:t.configurations,trafficTypeName:t.trafficTypeName})])})),Promise.all([o.splits.flush(),o.splits.addSplits(e)]).then((function(){i.splits.emit(i.splits.SDK_SPLITS_ARRIVED),i.segments.emit(i.segments.SDK_SEGMENTS_ARRIVED)}))):Promise.resolve()}}.bind(null,Hi),Yi=function(t){var e=t.get(t.constants.SETTINGS),n=Bi(t);return yi(n,e.scheduler.offlineRefreshRate)};var qi=function(t,e){var n=!e,r=t.get(t.constants.READINESS),o=t.get(t.constants.STORAGE),a=t.get(t.constants.STATUS_MANAGER);n&&setTimeout((function(){r.gate.emit(r.gate.SDK_READY)}),0);var s=n?void 0:Yi(t);return s&&s.start(),{api:i()(Object.create(a),_r(t),{destroy:function(){return s&&s.stop(),r.destroy(),o.destroy&&o.destroy(),t.put(t.constants.DESTROYED,!0),!n&&l(),Promise.resolve()}}),metricCollectors:!1}};function zi(t,e){var n=!1,r=!1;var i=function t(i){var o=new Promise((function(t,n){return i.then(t,(function(t){r?n(t):e(t)}))})),a=o.then;return o.then=function(e,i){var s=a.call(o,e,i);return"function"==typeof e&&(n=!0),"function"==typeof i?(r=!0,s):t(s)},o}(t);return i.hasOnFulfilled=function(){return n},i}var Vi=Object(s.b)("");function Qi(t){Vi.error(t)}function Ji(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=t.get(t.constants.READINESS).gate,r=0,o=!1,a=!1,s=n.SDK_READY,c=n.SDK_READY_FROM_CACHE,u=n.SDK_UPDATE,l=n.SDK_READY_TIMED_OUT;n.on("removeListener",(function(t){t===s&&r--})),n.on("newListener",(function(t){t!==s&&t!==l||(o?Vi.error("A listener was added for ".concat(t===s?"SDK_READY":"SDK_READY_TIMED_OUT"," on the SDK, which has already fired and won't be emitted again. The callback won't be executed.")):t===s&&r++)}));var f=h();function h(){var i=zi(new Promise((function(c,u){n.once(s,(function(){r!==e||i.hasOnFulfilled()||Vi.warn("No listeners for SDK Readiness detected. Incorrect control treatments could have been logged if you called getTreatment/s while the SDK was not yet ready."),t.put(t.constants.READY,!0),o=!0,c()})),n.once(l,(function(e){t.put(t.constants.HAS_TIMEDOUT,!0),a=!0,u(e)}))})),Qi);return i}return n.once(c,(function(){Vi.info("Split SDK is ready from cache."),t.put(t.constants.READY_FROM_CACHE,!0)})),i()(Object.create(n),{Event:{SDK_READY:s,SDK_READY_FROM_CACHE:c,SDK_UPDATE:u,SDK_READY_TIMED_OUT:l},ready:function(){return a?o?Promise.resolve():zi(Promise.reject("Split SDK has emitted SDK_READY_TIMED_OUT event."),Qi):f},__context:t})}var $i=Object(s.b)("splitio-ga-to-split");var Zi,Xi=(Zi={eventTypeId:{event:"eventAction",social:"socialAction"},eventValue:{event:"eventValue",timing:"timingValue"},eventProperties:{pageview:["page"],screenview:["screenName"],event:["eventCategory","eventLabel"],social:["socialNetwork","socialTarget"],timing:["timingCategory","timingVar","timingLabel"],exception:["exDescription","exFatal"]}},function(t){var e=t.get("hitType"),n=t.get(Zi.eventTypeId[e]||"hitType"),r=t.get(Zi.eventValue[e]),i={},o=Zi.eventProperties[e];if(o)for(var a=0;a<o.length;a++)i[o[a]]=t.get(o[a]);return{eventTypeId:n,value:r,properties:i,timestamp:Date.now()}});var to=/^[^a-zA-Z0-9]+/,eo=/[^-_.:a-zA-Z0-9]+/g;var no=function(t,e,n){var r,o,s,c={prefix:"ga",identities:n.key&&n.trafficType?[{key:n.key,trafficType:n.trafficType}]:void 0};r="splitTracker",o=function n(r,o){$()(this,n);var s=i()({},c,t,o);this.tracker=r;var u,l=(u=s.identities,Array.isArray(u)?Object(a.r)(u).filter((function(t){if(!t)return!1;var e=t.key,n=t.trafficType;return!(!Object(a.j)(e)&&!Object(a.l)(e)||!Object(a.j)(n))})):[]);if(0!==l.length){var f=l.length-s.identities.length;f&&$i.warn("".concat(f," identities were discarded because they are invalid or duplicated. Identities must be an array of objects with key and trafficType.")),s.identities=l,Object(a.j)(s.prefix)||($i.warn("The provided `prefix` was ignored since it is invalid. Please check that you are passing a string object as `prefix`."),s.prefix=void 0);var h=r.get("sendHitTask");r.set("sendHitTask",(function(t){if(h(t),!1!==s.hits&&!t.get("splitHit")){try{if(s.filter&&!s.filter(t))return}catch(t){return void $i.warn("GaToSplit custom filter threw: ".concat(t))}var n=Xi(t);if(s.mapper){try{n=s.mapper(t,n)}catch(t){return void $i.warn("GaToSplit custom mapper threw: ".concat(t))}if(!n)return}s.prefix&&(n.eventTypeId="".concat(s.prefix,".").concat(n.eventTypeId)),n.eventTypeId=function(t){if(!Object(a.j)(t)||0===t.length)return t;var e=t.replace(to,"").replace(eo,"_"),n=e.slice(0,80);return n.length<e.length&&$i.warn("EventTypeId was truncated because it cannot be more than 80 characters long."),n}(n.eventTypeId),function(t){return!(!g(t.eventTypeId,"splitio-ga-to-split:mapper")||!1===m(t.value,"splitio-ga-to-split:mapper")||!1===E(t.properties,"splitio-ga-to-split:mapper").properties||t.timestamp&&!Object(a.l)(t.timestamp)||t.key&&!1===N(t.key,"splitio-ga-to-split:mapper")||t.trafficTypeName&&!1===G(t.trafficTypeName,"splitio-ga-to-split:mapper"))}(n)&&(n.key&&n.trafficTypeName?e.events.track(event):s.identities.forEach((function(t){var r=i()({key:t.key,trafficTypeName:t.trafficType},n);e.events.track(r)})))}})),$i.info("Started GA-to-Split integration")}else $i.warn("No valid identities were provided. Please check that you are passing a valid list of identities or providing a traffic type at the SDK configuration.")},s=window.GoogleAnalyticsObject||"ga",window[s]=window[s]||function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];(window[s].q=window[s].q||[]).push(e)},window[s]("provide",r,o)},ro=Object(s.b)("splitio-split-to-ga"),io=function(){function t(e){if($()(this,t),"function"!=typeof t.getGa())return ro.warn("`ga` command queue not found. No hits will be sent."),{};this.trackerNames=t.defaultTrackerNames,e&&("function"==typeof e.filter&&(this.filter=e.filter),"function"==typeof e.mapper&&(this.mapper=e.mapper),Array.isArray(e.trackerNames)&&(this.trackerNames=Object(a.s)(e.trackerNames)),this.impressions=e.impressions,this.events=e.events),ro.info("Started Split-to-GA integration")}return X()(t,null,[{key:"defaultMapper",value:function(t){var e=t.type,n=t.payload;switch(e){case"IMPRESSION":return{hitType:"event",eventCategory:"split-impression",eventAction:"Evaluate "+n.impression.feature,eventLabel:"Treatment: "+n.impression.treatment+". Targeting rule: "+n.impression.label+".",nonInteraction:!0};case"EVENT":return{hitType:"event",eventCategory:"split-event",eventAction:n.eventTypeId,eventValue:n.value,nonInteraction:!0}}return null}},{key:"getGa",value:function(){return"undefined"!=typeof window?window[window.GoogleAnalyticsObject||"ga"]:void 0}},{key:"validateFieldsObject",value:function(t){return!(!t||!t.hitType)||(ro.warn("your custom mapper returned an invalid FieldsObject instance. It must be an object with at least a `hitType` field."),!1)}}]),X()(t,[{key:"queue",value:function(e){var n=t.getGa();if(n){if(!1===this.impressions&&"IMPRESSION"===e.type)return;if(!1===this.events&&"EVENT"===e.type)return;var r;try{if(this.filter&&!this.filter(e))return;if(r=t.defaultMapper(e),this.mapper&&(!(r=this.mapper(e,r))||!t.validateFieldsObject(r)))return}catch(t){return void ro.warn("SplitToGa queue method threw: ".concat(t,". No hit was sent."))}this.trackerNames.forEach((function(t){var e=t?"".concat(t,".send"):"send";r.splitHit=!0,n(e,r)}))}}}]),t}();io.defaultTrackerNames=[""];var oo=io,ao=function(t){var e=t.get(t.constants.SETTINGS),n=[];if(e.integrations.forEach((function(r){var i;switch(r.type){case"GOOGLE_ANALYTICS_TO_SPLIT":var o=t.get(t.constants.STORAGE),a=e.core;i=no(r,o,a);break;case"SPLIT_TO_GOOGLE_ANALYTICS":i=new oo(r)}i&&i.queue&&n.push(i)})),0!==n.length)return{handleImpression:function(t){n.forEach((function(e){return e.queue({type:"IMPRESSION",payload:t})}))},handleEvent:function(t){n.forEach((function(e){return e.queue({type:"EVENT",payload:t})}))}}},so=Object(s.b)("splitio"),co=function(t,e){return"".concat(t.matchingKey?t.matchingKey:t,"-").concat(t.bucketingKey?t.bucketingKey:t,"-").concat(void 0!==e?e:"")};e.default=function(t){var e,n,r={},i={splitsReadyTracker:Ae.start(Ae.TaskNames.SPLITS_READY),segmentsReadyTracker:Ae.start(Ae.TaskNames.SEGMENTS_READY),sdkReadyTracker:Ae.start(Ae.TaskNames.SDK_READY)},o=new le,l=ce(t);o.put(o.constants.SETTINGS,l),e=l.core.authorizationKey,n=!1,null==e?c.error("Factory instantiation: you passed a null or undefined api_key, api_key must be a non-empty string."):Object(a.j)(e)?e.length>0?n=e:c.error("Factory instantiation: you passed an empty api_key, api_key must be a non-empty string."):c.error("Factory instantiation: you passed an invalid api_key, api_key must be a non-empty string."),n&&(u[n]?(c.warn("Factory instantiation: You already have ".concat(u[n]," ").concat(1===u[n]?"factory":"factories"," with this API Key. We recommend keeping only one instance of the factory at all times (Singleton pattern) and reusing it throughout your application.")),u[n]++):(u[n]=1,Object.keys(u).length>1&&c.warn("Factory instantiation: You already have an instance of the Split factory. Make sure you definitely want this additional instance. We recommend keeping only one instance of the factory at all times (Singleton pattern) and reusing it throughout your application.")));var f=Wt(),h=f(l.startup.readyTimeout);o.put(o.constants.READINESS,h);var p=Ji(o);o.put(o.constants.STATUS_MANAGER,p);var g=Dt(o);o.put(o.constants.STORAGE,g);var d=ao(o);o.put(o.constants.INTEGRATIONS_MANAGER,d);var m="localhost"===l.mode?qi:xi,v=m(o,i),y=v.api,S=v.metricCollectors,T=Q(g.splits,o),b=fe(l.core.key),E=co(b,l.core.trafficType);return r[E]=y,so.info("New Split SDK instance created."),{client:function(t,e){if(void 0===t)return so.debug("Retrieving default SDK client."),y;if("function"!=typeof g.shared)throw"Shared Client not supported by the storage mechanism. Create isolated instances instead.";var n,i=N(t,"Shared Client instantiation");if(!1===i)throw"Shared Client needs a valid key.";if(void 0!==e&&!1===(n=G(e,"Shared Client instantiation")))throw"Shared Client needs a valid traffic type or no traffic type at all.";var a=co(i,n);if(r[a])so.debug("Retrieving existing SDK client.");else{var s=l.overrideKeyAndTT(i,n),c=new le,u=f(s.startup.readyTimeout);c.put(o.constants.READY_FROM_CACHE,o.get(o.constants.READY_FROM_CACHE,!0)),c.put(o.constants.READINESS,u),c.put(o.constants.STATUS_MANAGER,Ji(c,-1)),c.put(o.constants.SETTINGS,s),c.put(o.constants.STORAGE,g.shared(s)),r[a]=m(c,!1,S).api,so.info("New shared client instance created.")}return r[a]},manager:function(){return so.info("Manager instance retrieved."),T},Logger:s.a,settings:l}}}]).default}));